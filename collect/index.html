
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../architecture/">
      
      
        <link rel="next" href="../nlp/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.26">
    
    
      
        <title>collect - CivicLens DOCS</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#collect" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CivicLens DOCS" class="md-header__button md-logo" aria-label="CivicLens DOCS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CivicLens DOCS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              collect
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/uchicago-capp-30320/CivicLens" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    uchicago-capp-30320/CivicLens
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CivicLens DOCS" class="md-nav__button md-logo" aria-label="CivicLens DOCS" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    CivicLens DOCS
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/uchicago-capp-30320/CivicLens" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    uchicago-capp-30320/CivicLens
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CivicLens DOCS
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Models
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../architecture/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    collect
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    collect
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Started
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-1-retrieving-data-from-one-docket" class="md-nav__link">
    <span class="md-ellipsis">
      Example 1 - Retrieving data from one docket
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-2-retrieving-all-comments-made-in-the-first-two-weeks-of-april-2024" class="md-nav__link">
    <span class="md-ellipsis">
      Example 2 - Retrieving all comments made in the first two weeks of April 2024
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference" class="md-nav__link">
    <span class="md-ellipsis">
      Reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#civiclens.collect.access_api_data" class="md-nav__link">
    <span class="md-ellipsis">
      access_api_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="access_api_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.access_api_data.pull_reg_gov_data" class="md-nav__link">
    <span class="md-ellipsis">
      pull_reg_gov_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.access_api_data.api_date_format_params" class="md-nav__link">
    <span class="md-ellipsis">
      api_date_format_params
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database" class="md-nav__link">
    <span class="md-ellipsis">
      move_data_from_api_to_database
    </span>
  </a>
  
    <nav class="md-nav" aria-label="move_data_from_api_to_database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.add_comments_based_on_comment_date_range" class="md-nav__link">
    <span class="md-ellipsis">
      add_comments_based_on_comment_date_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.add_comments_to_db" class="md-nav__link">
    <span class="md-ellipsis">
      add_comments_to_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.add_comments_to_db_for_existing_doc" class="md-nav__link">
    <span class="md-ellipsis">
      add_comments_to_db_for_existing_doc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.add_comments_to_db_for_new_doc" class="md-nav__link">
    <span class="md-ellipsis">
      add_comments_to_db_for_new_doc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.add_data_quality_flag" class="md-nav__link">
    <span class="md-ellipsis">
      add_data_quality_flag
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.add_dockets_to_db" class="md-nav__link">
    <span class="md-ellipsis">
      add_dockets_to_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.add_documents_to_db" class="md-nav__link">
    <span class="md-ellipsis">
      add_documents_to_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.check_CFR_data" class="md-nav__link">
    <span class="md-ellipsis">
      check_CFR_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.clean_comment_data" class="md-nav__link">
    <span class="md-ellipsis">
      clean_comment_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.clean_document_data" class="md-nav__link">
    <span class="md-ellipsis">
      clean_document_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.connect_db_and_get_cursor" class="md-nav__link">
    <span class="md-ellipsis">
      connect_db_and_get_cursor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.extract_xml_text_from_doc" class="md-nav__link">
    <span class="md-ellipsis">
      extract_xml_text_from_doc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.fetch_fr_document_details" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_fr_document_details
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.fetch_xml_content" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_xml_content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.get_comment_text" class="md-nav__link">
    <span class="md-ellipsis">
      get_comment_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.get_most_recent_doc_comment_date" class="md-nav__link">
    <span class="md-ellipsis">
      get_most_recent_doc_comment_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.insert_comment_into_db" class="md-nav__link">
    <span class="md-ellipsis">
      insert_comment_into_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.insert_docket_into_db" class="md-nav__link">
    <span class="md-ellipsis">
      insert_docket_into_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.insert_document_into_db" class="md-nav__link">
    <span class="md-ellipsis">
      insert_document_into_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.merge_comment_text_and_data" class="md-nav__link">
    <span class="md-ellipsis">
      merge_comment_text_and_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.parse_xml_content" class="md-nav__link">
    <span class="md-ellipsis">
      parse_xml_content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.pull_all_api_data_for_date_range" class="md-nav__link">
    <span class="md-ellipsis">
      pull_all_api_data_for_date_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.qa_comment_data" class="md-nav__link">
    <span class="md-ellipsis">
      qa_comment_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.qa_docket_data" class="md-nav__link">
    <span class="md-ellipsis">
      qa_docket_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.qa_document_data" class="md-nav__link">
    <span class="md-ellipsis">
      qa_document_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.query_register_API_and_merge_document_data" class="md-nav__link">
    <span class="md-ellipsis">
      query_register_API_and_merge_document_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.validate_fr_doc_num" class="md-nav__link">
    <span class="md-ellipsis">
      validate_fr_doc_num
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.verify_database_existence" class="md-nav__link">
    <span class="md-ellipsis">
      verify_database_existence
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#civiclens.collect.bulk_dl" class="md-nav__link">
    <span class="md-ellipsis">
      bulk_dl
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bulk_dl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.bulk_dl.BulkDl" class="md-nav__link">
    <span class="md-ellipsis">
      BulkDl
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BulkDl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.bulk_dl.BulkDl.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.bulk_dl.BulkDl.fetch_all_pages" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_all_pages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.bulk_dl.BulkDl.fetch_comment_count_by_documents" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_comment_count_by_documents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.bulk_dl.BulkDl.fetch_documents_by_date_ranges" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_documents_by_date_ranges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.bulk_dl.BulkDl.generate_date_ranges" class="md-nav__link">
    <span class="md-ellipsis">
      generate_date_ranges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.bulk_dl.BulkDl.get_all_dockets_by_agency" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_dockets_by_agency
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nlp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    nlp
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Endpoints
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Endpoints
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../endpoints/home/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../endpoints/learn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Learn
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../endpoints/search/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../endpoints/document/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Document
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../endpoints/about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#getting-started" class="md-nav__link">
    <span class="md-ellipsis">
      Getting Started
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-1-retrieving-data-from-one-docket" class="md-nav__link">
    <span class="md-ellipsis">
      Example 1 - Retrieving data from one docket
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-2-retrieving-all-comments-made-in-the-first-two-weeks-of-april-2024" class="md-nav__link">
    <span class="md-ellipsis">
      Example 2 - Retrieving all comments made in the first two weeks of April 2024
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reference" class="md-nav__link">
    <span class="md-ellipsis">
      Reference
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#civiclens.collect.access_api_data" class="md-nav__link">
    <span class="md-ellipsis">
      access_api_data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="access_api_data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.access_api_data.pull_reg_gov_data" class="md-nav__link">
    <span class="md-ellipsis">
      pull_reg_gov_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.access_api_data.api_date_format_params" class="md-nav__link">
    <span class="md-ellipsis">
      api_date_format_params
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database" class="md-nav__link">
    <span class="md-ellipsis">
      move_data_from_api_to_database
    </span>
  </a>
  
    <nav class="md-nav" aria-label="move_data_from_api_to_database">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.add_comments_based_on_comment_date_range" class="md-nav__link">
    <span class="md-ellipsis">
      add_comments_based_on_comment_date_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.add_comments_to_db" class="md-nav__link">
    <span class="md-ellipsis">
      add_comments_to_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.add_comments_to_db_for_existing_doc" class="md-nav__link">
    <span class="md-ellipsis">
      add_comments_to_db_for_existing_doc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.add_comments_to_db_for_new_doc" class="md-nav__link">
    <span class="md-ellipsis">
      add_comments_to_db_for_new_doc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.add_data_quality_flag" class="md-nav__link">
    <span class="md-ellipsis">
      add_data_quality_flag
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.add_dockets_to_db" class="md-nav__link">
    <span class="md-ellipsis">
      add_dockets_to_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.add_documents_to_db" class="md-nav__link">
    <span class="md-ellipsis">
      add_documents_to_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.check_CFR_data" class="md-nav__link">
    <span class="md-ellipsis">
      check_CFR_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.clean_comment_data" class="md-nav__link">
    <span class="md-ellipsis">
      clean_comment_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.clean_document_data" class="md-nav__link">
    <span class="md-ellipsis">
      clean_document_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.connect_db_and_get_cursor" class="md-nav__link">
    <span class="md-ellipsis">
      connect_db_and_get_cursor
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.extract_xml_text_from_doc" class="md-nav__link">
    <span class="md-ellipsis">
      extract_xml_text_from_doc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.fetch_fr_document_details" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_fr_document_details
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.fetch_xml_content" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_xml_content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.get_comment_text" class="md-nav__link">
    <span class="md-ellipsis">
      get_comment_text
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.get_most_recent_doc_comment_date" class="md-nav__link">
    <span class="md-ellipsis">
      get_most_recent_doc_comment_date
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.insert_comment_into_db" class="md-nav__link">
    <span class="md-ellipsis">
      insert_comment_into_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.insert_docket_into_db" class="md-nav__link">
    <span class="md-ellipsis">
      insert_docket_into_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.insert_document_into_db" class="md-nav__link">
    <span class="md-ellipsis">
      insert_document_into_db
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.merge_comment_text_and_data" class="md-nav__link">
    <span class="md-ellipsis">
      merge_comment_text_and_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.parse_xml_content" class="md-nav__link">
    <span class="md-ellipsis">
      parse_xml_content
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.pull_all_api_data_for_date_range" class="md-nav__link">
    <span class="md-ellipsis">
      pull_all_api_data_for_date_range
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.qa_comment_data" class="md-nav__link">
    <span class="md-ellipsis">
      qa_comment_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.qa_docket_data" class="md-nav__link">
    <span class="md-ellipsis">
      qa_docket_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.qa_document_data" class="md-nav__link">
    <span class="md-ellipsis">
      qa_document_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.query_register_API_and_merge_document_data" class="md-nav__link">
    <span class="md-ellipsis">
      query_register_API_and_merge_document_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.validate_fr_doc_num" class="md-nav__link">
    <span class="md-ellipsis">
      validate_fr_doc_num
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.move_data_from_api_to_database.verify_database_existence" class="md-nav__link">
    <span class="md-ellipsis">
      verify_database_existence
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#civiclens.collect.bulk_dl" class="md-nav__link">
    <span class="md-ellipsis">
      bulk_dl
    </span>
  </a>
  
    <nav class="md-nav" aria-label="bulk_dl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.bulk_dl.BulkDl" class="md-nav__link">
    <span class="md-ellipsis">
      BulkDl
    </span>
  </a>
  
    <nav class="md-nav" aria-label="BulkDl">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.bulk_dl.BulkDl.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.bulk_dl.BulkDl.fetch_all_pages" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_all_pages
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.bulk_dl.BulkDl.fetch_comment_count_by_documents" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_comment_count_by_documents
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.bulk_dl.BulkDl.fetch_documents_by_date_ranges" class="md-nav__link">
    <span class="md-ellipsis">
      fetch_documents_by_date_ranges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.bulk_dl.BulkDl.generate_date_ranges" class="md-nav__link">
    <span class="md-ellipsis">
      generate_date_ranges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#civiclens.collect.bulk_dl.BulkDl.get_all_dockets_by_agency" class="md-nav__link">
    <span class="md-ellipsis">
      get_all_dockets_by_agency
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="collect">collect<a class="headerlink" href="#collect" title="Permanent link">&para;</a></h1>
<p>Quick start guide for CivicLens' internal library for accessing data via the regulations.gov API. This library contains methods for collecting comments, dockets, and documents from regulations.gov.</p>
<h2 id="getting-started">Getting Started<a class="headerlink" href="#getting-started" title="Permanent link">&para;</a></h2>
<p>To collect data from regulations.gov, you'll first need an API key which you can request <a href="https://open.gsa.gov/api/regulationsgov/">here</a>. Once you have your key, you can add it as an Environment Variable by following the steps described under <a href="../#contributing">Contributing</a>, or you can replace <code>api_key</code> with your unique key.</p>
<h2 id="example-1-retrieving-data-from-one-docket">Example 1 - Retrieving data from one docket<a class="headerlink" href="#example-1-retrieving-data-from-one-docket" title="Permanent link">&para;</a></h2>
<p>Let's walk through how to collect data for the proposed rule "FR-6362-P-01 Reducing Barriers to HUD-Assisted Housing." You can read the actual rule and view comments at this <a href="https://www.regulations.gov/document/HUD-2024-0031-0001">link</a>. To collect data on this rule, we'll need to search by the Document ID, which we can pass into the <code>params</code> argument like this:</p>
<p><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">access_api_data</span> <span class="kn">import</span> <span class="n">pull_reg_gov_data</span>

<span class="n">api_key</span> <span class="o">=</span> <span class="s2">&quot;YOUR-KEY_HERE&quot;</span>
<span class="n">search_terms</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;filter[searchTerm]&quot;</span><span class="p">:</span> <span class="s2">&quot;HUD-2024-0031-0001&quot;</span><span class="p">}</span>

<span class="n">doc</span> <span class="o">=</span> <span class="n">pull_reg_gov_data</span><span class="p">(</span>
    <span class="n">api_key</span><span class="p">,</span>
    <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;documents&quot;</span><span class="p">,</span>  <span class="c1"># set the datatype to document</span>
    <span class="n">params</span><span class="o">=</span><span class="n">search_terms</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
Now that we've collected the metadata for the document, we can use the documents's object ID to collect all the comments posted to it.</p>
<div class="highlight"><pre><span></span><code><span class="n">doc_object_id</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;objectId&quot;</span><span class="p">]</span>

<span class="n">comment_data</span> <span class="o">=</span> <span class="n">pull_reg_gov_data</span><span class="p">(</span>
    <span class="n">api_key</span><span class="p">,</span>
    <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;comments&quot;</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;filter[commentOnId]&quot;</span><span class="p">:</span> <span class="n">doc_object_id</span><span class="p">},</span>
<span class="p">)</span>
</code></pre></div>
<p>Finally, we can get the text for each comment by iterating over the comment metadata and making an additional request for the text.</p>
<div class="highlight"><pre><span></span><code><span class="n">comment_json_text</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">commentId</span> <span class="ow">in</span> <span class="n">comment_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;objectId&quot;</span><span class="p">]:</span>
    <span class="n">comment_json_text</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">pull_reg_gov_data</span><span class="p">(</span>
            <span class="n">api_key</span><span class="p">,</span>
            <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;comments&quot;</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;filter[commentOnId]&quot;</span><span class="p">:</span> <span class="n">commentId</span><span class="p">},</span>
        <span class="p">)</span>
    <span class="p">)</span>
</code></pre></div>
<h2 id="example-2-retrieving-all-comments-made-in-the-first-two-weeks-of-april-2024">Example 2 - Retrieving all comments made in the first two weeks of April 2024<a class="headerlink" href="#example-2-retrieving-all-comments-made-in-the-first-two-weeks-of-april-2024" title="Permanent link">&para;</a></h2>
<p>In this example, we demonstrate how to gather all public comments posted within the first ten days of April 2024.
This method can also be applied to collect documents or dockets by adjusting 'data_type'.
<div class="highlight"><pre><span></span><code><span class="n">comments_apr_01_10</span> <span class="o">=</span> <span class="n">pull_reg_gov_data</span><span class="p">(</span>
    <span class="n">api_key</span><span class="p">,</span>
    <span class="n">data_type</span><span class="o">=</span><span class="s2">&quot;comments&quot;</span><span class="p">,</span>
    <span class="n">start_date</span><span class="o">=</span><span class="s2">&quot;2024-05-01&quot;</span><span class="p">,</span>
    <span class="n">end_date</span><span class="o">=</span><span class="s2">&quot;2024-05-10&quot;</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></p>
<h2 id="reference">Reference<a class="headerlink" href="#reference" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<h2 id="civiclens.collect.access_api_data" class="doc doc-heading">
            <code>access_api_data</code>


<a href="#civiclens.collect.access_api_data" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">

      <p>This code pulls heavily from the following existing repositories:</p>
<p>https://github.com/willjobs/regulations-public-comments
https://github.com/jacobfeldgoise/regulations-comments-downloader</p>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.access_api_data.pull_reg_gov_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pull_reg_gov_data</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">print_remaining_requests</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#civiclens.collect.access_api_data.pull_reg_gov_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Returns the JSON associated with a request to the API; max length of 24000</p>
<p>Draws heavily from this [repository]
(https://github.com/willjobs/regulations-public-comments/blob/master/
comments_downloader.py)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data_type</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>'dockets', 'documents', or 'comments' -- what kind of
data we want back from the API</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>start_date</code></td>
            <td>
                  <code>str in YYYY-MM-DD format</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the inclusive start
date of our data pull</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>end_date</code></td>
            <td>
                  <code>str in YYYY-MM-DD format</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the inclusive end date
of our data pull</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>params</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters to specify to the endpoint request.
Defaults to None.
If we are querying the non-details endpoint, we also append the
"page[size]" parameter so that we always get the maximum page size
of 250 elements per page.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>print_remaining_requests</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to print out the
number of remaining requests this hour, based on the response
headers.
Defaults to False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>wait_for_rate_reset</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Determines whether to wait to
re-try if we run out of requests in a given hour. Defaults to
False.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>skip_duplicates</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If a request returns multiple items
when only 1 was expected, should we skip that request? Defaults to
False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>JSON-ified request response</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/access_api_data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pull_reg_gov_data</span><span class="p">(</span>  <span class="c1"># noqa: C901,E501</span>
    <span class="n">api_key</span><span class="p">,</span>
    <span class="n">data_type</span><span class="p">,</span>
    <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">params</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">print_remaining_requests</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">skip_duplicates</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the JSON associated with a request to the API; max length of 24000</span>

<span class="sd">    Draws heavily from this [repository]</span>
<span class="sd">    (https://github.com/willjobs/regulations-public-comments/blob/master/</span>
<span class="sd">    comments_downloader.py)</span>

<span class="sd">    Args:</span>
<span class="sd">        data_type (str): &#39;dockets&#39;, &#39;documents&#39;, or &#39;comments&#39; -- what kind of</span>
<span class="sd">            data we want back from the API</span>
<span class="sd">        start_date (str in YYYY-MM-DD format, optional): the inclusive start</span>
<span class="sd">            date of our data pull</span>
<span class="sd">        end_date (str in YYYY-MM-DD format, optional): the inclusive end date</span>
<span class="sd">            of our data pull</span>
<span class="sd">        params (dict, optional): Parameters to specify to the endpoint request.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">            If we are querying the non-details endpoint, we also append the</span>
<span class="sd">            &quot;page[size]&quot; parameter so that we always get the maximum page size</span>
<span class="sd">            of 250 elements per page.</span>
<span class="sd">        print_remaining_requests (bool, optional): Whether to print out the</span>
<span class="sd">            number of remaining requests this hour, based on the response</span>
<span class="sd">            headers.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">        wait_for_rate_reset (bool, optional): Determines whether to wait to</span>
<span class="sd">            re-try if we run out of requests in a given hour. Defaults to</span>
<span class="sd">            False.</span>
<span class="sd">        skip_duplicates (bool, optional): If a request returns multiple items</span>
<span class="sd">            when only 1 was expected, should we skip that request? Defaults to</span>
<span class="sd">            False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        dict: JSON-ified request response</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># generate the right API request</span>
    <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.regulations.gov/v4/&quot;</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_url</span><span class="si">}{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">params</span> <span class="k">if</span> <span class="n">params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{}</span>

    <span class="c1"># Our API key has a rate limit of 1,000 requests/hour.</span>
    <span class="c1"># If we hit that limit, we can</span>
    <span class="c1"># retry every WAIT_MINUTES minutes (more frequently than once an hour, in</span>
    <span class="c1"># case our request limit</span>
    <span class="c1"># is updated sooner). We will sleep for POLL_SECONDS seconds at a time to</span>
    <span class="c1"># see if we&#39;ve been</span>
    <span class="c1"># interrupted. Otherwise we&#39;d have to wait a while before getting</span>
    <span class="c1"># interrupted. We could do this</span>
    <span class="c1"># with threads, but that gets more complicated than it needs to be.</span>
    <span class="n">STATUS_CODE_OVER_RATE_LIMIT</span> <span class="o">=</span> <span class="mi">429</span>
    <span class="n">WAIT_SECONDS</span> <span class="o">=</span> <span class="mi">3600</span>  <span class="c1"># Default to 1 hour</span>

    <span class="c1"># if any dates are specified, format those and add to the params</span>
    <span class="k">if</span> <span class="n">start_date</span> <span class="ow">or</span> <span class="n">end_date</span><span class="p">:</span>
        <span class="n">param_dates</span> <span class="o">=</span> <span class="n">api_date_format_params</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
        <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">param_dates</span><span class="p">)</span>

    <span class="c1"># whether we are querying the search endpoint (e.g., /documents)</span>
    <span class="c1"># or the &quot;details&quot; endpoint</span>
    <span class="k">if</span> <span class="n">endpoint</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;dockets&quot;</span><span class="p">,</span> <span class="s2">&quot;documents&quot;</span><span class="p">,</span> <span class="s2">&quot;comments&quot;</span><span class="p">]:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">params</span><span class="p">,</span> <span class="s2">&quot;page[size]&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">}</span>  <span class="c1"># always get max page size</span>

    <span class="c1"># Rather than do requests.get(), use this approach to (attempt to)</span>
    <span class="c1"># gracefully handle noisy connections to the server</span>
    <span class="c1"># We sometimes get SSL errors (unexpected EOF or ECONNRESET), so this</span>
    <span class="c1"># should hopefully help us retry.</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">poll_for_response</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span> <span class="n">wait_for_rate_reset</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;X-Api-Key&quot;</span><span class="p">:</span> <span class="n">api_key</span><span class="p">},</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="c1"># SUCCESS! Return the JSON of the request</span>
            <span class="n">num_requests_left</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s2">&quot;X-RateLimit-Remaining&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">print_remaining_requests</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">num_requests_left</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">)</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">num_requests_left</span> <span class="o">&lt;=</span> <span class="mi">100</span> <span class="ow">and</span> <span class="n">num_requests_left</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">num_requests_left</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">num_requests_left</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(Requests left: </span><span class="si">{</span><span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;X-RateLimit-Remaining&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">r</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">STATUS_CODE_OVER_RATE_LIMIT</span>
                <span class="ow">and</span> <span class="n">wait_for_rate_reset</span>
            <span class="p">):</span>
                <span class="n">the_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
                <span class="n">retry_after</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Retry-After&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">wait_time</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">retry_after</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">retry_after</span> <span class="ow">and</span> <span class="n">retry_after</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
                    <span class="k">else</span> <span class="n">WAIT_SECONDS</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Rate limit exceeded at </span><span class="si">{</span><span class="n">the_time</span><span class="si">}</span><span class="s2">.</span>
<span class="s2">                    Waiting </span><span class="si">{</span><span class="n">wait_time</span><span class="si">}</span><span class="s2"> seconds to retry.&quot;&quot;&quot;</span>
                <span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">_is_duplicated_on_server</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">())</span> <span class="ow">and</span> <span class="n">skip_duplicates</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;****Duplicate entries on server. Skipping.&quot;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;errors&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;detail&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># some other kind of error</span>
                <span class="nb">print</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">status_code</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
                <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>

        <span class="k">return</span> <span class="p">[</span><span class="kc">False</span><span class="p">,</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()]</span>

    <span class="k">if</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;comments&quot;</span> <span class="ow">or</span> <span class="n">data_type</span> <span class="o">==</span> <span class="s2">&quot;documents&quot;</span><span class="p">:</span>
        <span class="n">all_objects</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">unique_objects</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;page[size]&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
                <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="s2">&quot;lastModifiedDate,documentId&quot;</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

        <span class="n">last_modified_date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">continue_fetching</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">while</span> <span class="n">continue_fetching</span><span class="p">:</span>
            <span class="n">success</span><span class="p">,</span> <span class="n">r_json</span> <span class="o">=</span> <span class="n">poll_for_response</span><span class="p">(</span>
                <span class="n">api_key</span><span class="p">,</span> <span class="n">wait_for_rate_reset</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="n">all_objects</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">r_json</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Fetched </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">r_json</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2"> objects,</span>
<span class="s2">                    total: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_objects</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
                <span class="p">)</span>

                <span class="c1"># Check and handle the pagination</span>
                <span class="n">has_next_page</span> <span class="o">=</span> <span class="n">r_json</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasNextPage&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Has next page: </span><span class="si">{</span><span class="n">has_next_page</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">r_json</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">250</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">has_next_page</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span>
<span class="w">                        </span><span class="sd">&quot;&quot;&quot;No more pages or fewer than 250</span>
<span class="sd">                        comments fetched, stopping...&quot;&quot;&quot;</span>
                    <span class="p">)</span>
                    <span class="n">continue_fetching</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">last_modified_date</span> <span class="o">=</span> <span class="n">format_datetime_for_api</span><span class="p">(</span>
                        <span class="n">r_json</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;lastModifiedDate&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                    <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s2">&quot;filter[lastModifiedDate][ge]&quot;</span><span class="p">:</span> <span class="n">last_modified_date</span><span class="p">,</span>
                            <span class="s2">&quot;page[size]&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
                            <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="s2">&quot;lastModifiedDate,documentId&quot;</span><span class="p">,</span>
                            <span class="s2">&quot;page[number]&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
                        <span class="p">}</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">end_date</span><span class="p">:</span>
                        <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;filter[lastModifiedDate][le]&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2"> 23:59:59&quot;</span>  <span class="c1"># noqa: E501</span>
                            <span class="p">}</span>
                        <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fetching more data from </span><span class="si">{</span><span class="n">last_modified_date</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to fetch data&quot;</span><span class="p">)</span>
                <span class="n">continue_fetching</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># Remove Duplicates</span>
        <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">all_objects</span><span class="p">:</span>
            <span class="n">unique_objects</span><span class="p">[</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">obj</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">unique_objects</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">doc_data</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Initialize doc_data to None</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">21</span><span class="p">):</span>  <span class="c1"># Fetch up to 20 pages</span>
            <span class="n">params</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;page[size]&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span>
                    <span class="c1"># Ensure that only lastModifiedDate is considered,</span>
                    <span class="c1"># dockets cant take in documentID</span>
                    <span class="s2">&quot;sort&quot;</span><span class="p">:</span> <span class="s2">&quot;lastModifiedDate&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;page[number]&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span>
                    <span class="s2">&quot;api_key&quot;</span><span class="p">:</span> <span class="n">api_key</span><span class="p">,</span>
                <span class="p">}</span>
            <span class="p">)</span>

            <span class="n">success</span><span class="p">,</span> <span class="n">r_json</span> <span class="o">=</span> <span class="n">poll_for_response</span><span class="p">(</span>
                <span class="n">api_key</span><span class="p">,</span> <span class="n">wait_for_rate_reset</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">success</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="n">_is_duplicated_on_server</span><span class="p">(</span><span class="n">r_json</span><span class="p">)</span> <span class="ow">and</span> <span class="n">skip_duplicates</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="n">doc_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">doc_data</span> <span class="o">+=</span> <span class="n">r_json</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">doc_data</span> <span class="o">=</span> <span class="n">r_json</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span>

            <span class="c1"># Break if it&#39;s the last page</span>
            <span class="k">if</span> <span class="n">r_json</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">][</span><span class="s2">&quot;lastPage&quot;</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">doc_data</span>

    <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unrecoverable error; </span><span class="si">{</span><span class="n">r_json</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.access_api_data.api_date_format_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">api_date_format_params</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#civiclens.collect.access_api_data.api_date_format_params" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Formats dates to be passed to API call. Assumes we want whole days, and
aren't filtering by time.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>start_date</code></td>
            <td>
                  <code>str in YYYY-MM-DD format</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the inclusive start
date of our data pull</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>end_date</code></td>
            <td>
                  <code>str in YYYY-MM-DD format</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the inclusive end date
of our data pull</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>date_param</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dict containing the right formatted date calls</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/access_api_data.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">api_date_format_params</span><span class="p">(</span><span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Formats dates to be passed to API call. Assumes we want whole days, and</span>
<span class="sd">    aren&#39;t filtering by time.</span>

<span class="sd">    Args:</span>
<span class="sd">        start_date (str in YYYY-MM-DD format, optional): the inclusive start</span>
<span class="sd">            date of our data pull</span>
<span class="sd">        end_date (str in YYYY-MM-DD format, optional): the inclusive end date</span>
<span class="sd">            of our data pull</span>

<span class="sd">    Returns:</span>
<span class="sd">        date_param (dict): dict containing the right formatted date calls</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">date_param</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">date_param</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;filter[lastModifiedDate][ge]&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2"> 00:00:00&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">start_date</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">date_param</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;filter[lastModifiedDate][le]&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2"> 23:59:59&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">end_date</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">date_param</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="civiclens.collect.move_data_from_api_to_database" class="doc doc-heading">
            <code>move_data_from_api_to_database</code>


<a href="#civiclens.collect.move_data_from_api_to_database" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.add_comments_based_on_comment_date_range" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_comments_based_on_comment_date_range</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.add_comments_based_on_comment_date_range" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Add comments to the comments table based on a date range of when the
comments were posted</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>start_date</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the date in YYYY-MM-DD format to pull data from
(inclusive)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>end_date</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the date in YYYY-MM-DD format to stop the data pull
(inclusive)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Returns: nothing; adds comments, if available, to the db</p>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span>
<span class="normal">1277</span>
<span class="normal">1278</span>
<span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span>
<span class="normal">1316</span>
<span class="normal">1317</span>
<span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_comments_based_on_comment_date_range</span><span class="p">(</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add comments to the comments table based on a date range of when the</span>
<span class="sd">    comments were posted</span>

<span class="sd">    Args:</span>
<span class="sd">        start_date (str): the date in YYYY-MM-DD format to pull data from</span>
<span class="sd">            (inclusive)</span>
<span class="sd">        end_date (str): the date in YYYY-MM-DD format to stop the data pull</span>
<span class="sd">            (inclusive)</span>

<span class="sd">    Returns: nothing; adds comments, if available, to the db</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">comment_data</span> <span class="o">=</span> <span class="n">pull_reg_gov_data</span><span class="p">(</span>
        <span class="n">REG_GOV_API_KEY</span><span class="p">,</span>
        <span class="s2">&quot;comments&quot;</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="n">comment_data</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;processing comment </span><span class="si">{</span><span class="n">comment</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> &quot;</span><span class="p">)</span>

        <span class="n">all_comment_data</span> <span class="o">=</span> <span class="n">merge_comment_text_and_data</span><span class="p">(</span><span class="n">REG_GOV_API_KEY</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span>

        <span class="n">document_id</span> <span class="o">=</span> <span class="n">all_comment_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s2">&quot;commentOnDocumentId&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
        <span class="p">)</span>

        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;checking </span><span class="si">{</span><span class="n">document_id</span><span class="si">}</span><span class="s2"> is in the db&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">verify_database_existence</span><span class="p">(</span>
            <span class="s2">&quot;regulations_document&quot;</span><span class="p">,</span>
            <span class="n">document_id</span><span class="p">,</span>
            <span class="s2">&quot;id&quot;</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">document_id</span><span class="si">}</span><span class="s2"> is in the db! begin processing comment&quot;</span>
            <span class="p">)</span>

            <span class="c1"># clean</span>
            <span class="n">clean_comment_data</span><span class="p">(</span><span class="n">all_comment_data</span><span class="p">)</span>

            <span class="c1"># qa</span>
            <span class="n">qa_comment_data</span><span class="p">(</span><span class="n">all_comment_data</span><span class="p">)</span>

            <span class="c1"># insert</span>
            <span class="n">insert_response</span> <span class="o">=</span> <span class="n">insert_comment_into_db</span><span class="p">(</span><span class="n">all_comment_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">insert_response</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">insert_response</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;added comment </span><span class="si">{</span><span class="n">all_comment_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> to the db&quot;</span>
                <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.add_comments_to_db" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_comments_to_db</span><span class="p">(</span><span class="n">doc_list</span><span class="p">,</span> <span class="n">print_statements</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.add_comments_to_db" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Add comments on a list of documents to the database</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>doc_list</code></td>
            <td>
                  <code>list of json objects</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>what is returned from an API call for
documents</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>print_statements</code></td>
            <td>
                  <code>boolean</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to print info on progress</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span>
<span class="normal">1254</span>
<span class="normal">1255</span>
<span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_comments_to_db</span><span class="p">(</span>
    <span class="n">doc_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">print_statements</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add comments on a list of documents to the database</span>

<span class="sd">    Args:</span>
<span class="sd">        doc_list (list of json objects): what is returned from an API call for</span>
<span class="sd">            documents</span>
<span class="sd">        print_statements (boolean): whether to print info on progress</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">doc_list</span><span class="p">:</span>
        <span class="n">document_id</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">document_object_id</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;objectId&quot;</span><span class="p">]</span>
        <span class="n">commentable</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;openForComment&quot;</span><span class="p">]</span>
        <span class="c1"># get the comments, comment text, and add to db</span>
        <span class="k">if</span> <span class="n">commentable</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">verify_database_existence</span><span class="p">(</span>
                <span class="s2">&quot;regulations_comment&quot;</span><span class="p">,</span> <span class="n">document_id</span><span class="p">,</span> <span class="s2">&quot;document_id&quot;</span>
            <span class="p">):</span>  <span class="c1"># doc doesn&#39;t exist in the db; it&#39;s new</span>
                <span class="k">if</span> <span class="n">print_statements</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;no comments found in database for document</span>
<span class="s2">                        </span><span class="si">{</span><span class="n">document_id</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
                    <span class="p">)</span>

                <span class="n">add_comments_to_db_for_new_doc</span><span class="p">(</span><span class="n">document_object_id</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">print_statements</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;tried to add comments on document</span>
<span class="s2">                        </span><span class="si">{</span><span class="n">document_id</span><span class="si">}</span><span class="s2"> to the db&quot;&quot;&quot;</span>
                    <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>  <span class="c1"># doc exists in db; only need to add new comments</span>
                <span class="n">add_comments_to_db_for_existing_doc</span><span class="p">(</span>
                    <span class="n">document_id</span><span class="p">,</span> <span class="n">document_object_id</span><span class="p">,</span> <span class="n">print_statements</span>
                <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.add_comments_to_db_for_existing_doc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_comments_to_db_for_existing_doc</span><span class="p">(</span><span class="n">document_id</span><span class="p">,</span> <span class="n">document_object_id</span><span class="p">,</span> <span class="n">print_statements</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.add_comments_to_db_for_existing_doc" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Gets the most recent comment in the comments table and pulls comments for
    a doc from the API since then</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>document</code></td>
            <td>
                  <code>id (str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the id for the document we want comments for (comes
from the document json object)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>document_object_id</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the object id for the document we want
comments for (comes from the document json object)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>print_statements</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to print during, default is true</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Returns: nothing; adds comments, if available, to the db</p>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_comments_to_db_for_existing_doc</span><span class="p">(</span>
    <span class="n">document_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">document_object_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">print_statements</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Gets the most recent comment in the comments table and pulls comments for</span>
<span class="sd">        a doc from the API since then</span>

<span class="sd">    Args:</span>
<span class="sd">        document id (str): the id for the document we want comments for (comes</span>
<span class="sd">            from the document json object)</span>
<span class="sd">        document_object_id (str): the object id for the document we want</span>
<span class="sd">            comments for (comes from the document json object)</span>
<span class="sd">        print_statements (bool): whether to print during, default is true</span>

<span class="sd">    Returns: nothing; adds comments, if available, to the db</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get date of most recent comment on this doc in the db</span>
    <span class="n">most_recent_comment_date</span> <span class="o">=</span> <span class="n">get_most_recent_doc_comment_date</span><span class="p">(</span><span class="n">document_id</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">print_statements</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;&quot;&quot;comments found for document </span><span class="si">{</span><span class="n">document_id</span><span class="si">}</span><span class="s2">, most recent was</span>
<span class="s2">            </span><span class="si">{</span><span class="n">most_recent_comment_date</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="p">)</span>

    <span class="n">comment_data</span> <span class="o">=</span> <span class="n">pull_reg_gov_data</span><span class="p">(</span>
        <span class="n">REG_GOV_API_KEY</span><span class="p">,</span>
        <span class="s2">&quot;comments&quot;</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;filter[commentOnId]&quot;</span><span class="p">:</span> <span class="n">document_object_id</span><span class="p">,</span>
            <span class="s2">&quot;filter[lastModifiedDate][ge]&quot;</span><span class="p">:</span> <span class="n">most_recent_comment_date</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="n">comment_data</span><span class="p">:</span>
        <span class="n">all_comment_data</span> <span class="o">=</span> <span class="n">merge_comment_text_and_data</span><span class="p">(</span><span class="n">REG_GOV_API_KEY</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span>

        <span class="c1"># if documumrnent is not in the db, add it</span>
        <span class="n">document_id</span> <span class="o">=</span> <span class="n">all_comment_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;commentOnDocumentId&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">verify_database_existence</span><span class="p">(</span>
            <span class="s2">&quot;regulations_document&quot;</span><span class="p">,</span> <span class="n">document_id</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span>
        <span class="p">):</span>
            <span class="c1"># call the API to get the document info</span>
            <span class="n">doc_list</span> <span class="o">=</span> <span class="n">pull_reg_gov_data</span><span class="p">(</span>
                <span class="n">REG_GOV_API_KEY</span><span class="p">,</span>
                <span class="s2">&quot;documents&quot;</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;filter[objectId]&quot;</span><span class="p">:</span> <span class="n">document_id</span><span class="p">},</span>
            <span class="p">)</span>
            <span class="n">add_documents_to_db</span><span class="p">(</span><span class="n">doc_list</span><span class="p">)</span>

        <span class="c1"># clean</span>
        <span class="n">clean_comment_data</span><span class="p">(</span><span class="n">all_comment_data</span><span class="p">)</span>

        <span class="c1"># qa</span>
        <span class="n">qa_comment_data</span><span class="p">(</span><span class="n">all_comment_data</span><span class="p">)</span>

        <span class="n">insert_response</span> <span class="o">=</span> <span class="n">insert_comment_into_db</span><span class="p">(</span><span class="n">all_comment_data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">insert_response</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">insert_response</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.add_comments_to_db_for_new_doc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_comments_to_db_for_new_doc</span><span class="p">(</span><span class="n">document_object_id</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.add_comments_to_db_for_new_doc" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Add comments to the comments table for a new doc (ie, when we have just
    added the doc to the database)</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>document_object_id</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the object id for the document we want
comments for (comes from the document json object)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Returns: nothing; adds comments, if available, to the db</p>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_comments_to_db_for_new_doc</span><span class="p">(</span><span class="n">document_object_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add comments to the comments table for a new doc (ie, when we have just</span>
<span class="sd">        added the doc to the database)</span>

<span class="sd">    Args:</span>
<span class="sd">        document_object_id (str): the object id for the document we want</span>
<span class="sd">            comments for (comes from the document json object)</span>

<span class="sd">    Returns: nothing; adds comments, if available, to the db</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">comment_data</span> <span class="o">=</span> <span class="n">pull_reg_gov_data</span><span class="p">(</span>
        <span class="n">REG_GOV_API_KEY</span><span class="p">,</span>
        <span class="s2">&quot;comments&quot;</span><span class="p">,</span>
        <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;filter[commentOnId]&quot;</span><span class="p">:</span> <span class="n">document_object_id</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="c1"># add comment data to comments table in the database</span>
    <span class="k">for</span> <span class="n">comment</span> <span class="ow">in</span> <span class="n">comment_data</span><span class="p">:</span>
        <span class="n">all_comment_data</span> <span class="o">=</span> <span class="n">merge_comment_text_and_data</span><span class="p">(</span><span class="n">REG_GOV_API_KEY</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span>

        <span class="c1"># clean</span>
        <span class="n">clean_comment_data</span><span class="p">(</span><span class="n">all_comment_data</span><span class="p">)</span>

        <span class="c1"># qa</span>
        <span class="n">qa_comment_data</span><span class="p">(</span><span class="n">all_comment_data</span><span class="p">)</span>

        <span class="n">insert_response</span> <span class="o">=</span> <span class="n">insert_comment_into_db</span><span class="p">(</span><span class="n">all_comment_data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">insert_response</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">insert_response</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.add_data_quality_flag" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_data_quality_flag</span><span class="p">(</span><span class="n">data_id</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">error_message</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.add_data_quality_flag" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Add data to the regulations_dataqa table is qa assert statements flag</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>data_id</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>id field of the data in question</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>data_type</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether docket, document, or comment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>error_message</code></td>
            <td>
                  <code>Error</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the error and message raised by the assert
statement</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Returns: nothing, add a row to regulations_dataqa</p>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_data_quality_flag</span><span class="p">(</span>
    <span class="n">data_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add data to the regulations_dataqa table is qa assert statements flag</span>

<span class="sd">    Args:</span>
<span class="sd">        data_id (str): id field of the data in question</span>
<span class="sd">        data_type (str): whether docket, document, or comment</span>
<span class="sd">        error_message (Error): the error and message raised by the assert</span>
<span class="sd">            statement</span>
<span class="sd">    Returns: nothing, add a row to regulations_dataqa</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">connection</span><span class="p">,</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">connect_db_and_get_cursor</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">connection</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="w">                </span><span class="sd">&quot;&quot;&quot;INSERT INTO regulations_dataqa (</span>
<span class="sd">                    &quot;data_id&quot;,</span>
<span class="sd">                    &quot;data_type&quot;,</span>
<span class="sd">                    &quot;error_message&quot;,</span>
<span class="sd">                    &quot;added_at&quot;</span>
<span class="sd">                ) VALUES (%s, %s, %s, %s)</span>
<span class="sd">                ON CONFLICT (id) DO UPDATE SET</span>
<span class="sd">                    data_id = EXCLUDED.data_id,</span>
<span class="sd">                    data_type = EXCLUDED.data_type,</span>
<span class="sd">                    error_message = EXCLUDED.error_message,</span>
<span class="sd">                    added_at = EXCLUDED.added_at;&quot;&quot;&quot;</span><span class="p">,</span>
                <span class="p">(</span><span class="n">data_id</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">error_message</span><span class="p">),</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()),</span>
            <span class="p">)</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added data quality flag for </span><span class="si">{</span><span class="n">data_id</span><span class="si">}</span><span class="s2"> of type </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.add_dockets_to_db" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_dockets_to_db</span><span class="p">(</span><span class="n">doc_list</span><span class="p">,</span> <span class="n">print_statements</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.add_dockets_to_db" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Add the dockets connected to a list of documents into the database</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>doc_list</code></td>
            <td>
                  <code>list of json objects</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>what is returned from an API call
for documents</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>print_statements</code></td>
            <td>
                  <code>boolean</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to print info on progress</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_dockets_to_db</span><span class="p">(</span>
    <span class="n">doc_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">print_statements</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add the dockets connected to a list of documents into the database</span>

<span class="sd">    Args:</span>
<span class="sd">        doc_list (list of json objects): what is returned from an API call</span>
<span class="sd">            for documents</span>
<span class="sd">        print_statements (boolean): whether to print info on progress</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">doc_list</span><span class="p">:</span>
        <span class="n">docket_id</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;docketId&quot;</span><span class="p">]</span>
        <span class="n">commentable</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;openForComment&quot;</span><span class="p">]</span>
        <span class="c1"># if docket not in db, add it</span>
        <span class="k">if</span> <span class="n">commentable</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">verify_database_existence</span><span class="p">(</span><span class="s2">&quot;regulations_docket&quot;</span><span class="p">,</span> <span class="n">docket_id</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">docket_data</span> <span class="o">=</span> <span class="n">pull_reg_gov_data</span><span class="p">(</span>
                <span class="n">REG_GOV_API_KEY</span><span class="p">,</span>
                <span class="s2">&quot;dockets&quot;</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;filter[searchTerm]&quot;</span><span class="p">:</span> <span class="n">docket_id</span><span class="p">},</span>
            <span class="p">)</span>

            <span class="c1"># clean</span>
            <span class="n">clean_docket_data</span><span class="p">(</span><span class="n">docket_data</span><span class="p">)</span>

            <span class="c1"># qa</span>
            <span class="n">qa_docket_data</span><span class="p">(</span><span class="n">docket_data</span><span class="p">)</span>

            <span class="c1"># add docket_data to docket table in the database</span>
            <span class="n">insert_response</span> <span class="o">=</span> <span class="n">insert_docket_into_db</span><span class="p">(</span><span class="n">docket_data</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">insert_response</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">insert_response</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">print_statements</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added docket </span><span class="si">{</span><span class="n">docket_id</span><span class="si">}</span><span class="s2"> to the db&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.add_documents_to_db" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_documents_to_db</span><span class="p">(</span><span class="n">doc_list</span><span class="p">,</span> <span class="n">print_statements</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.add_documents_to_db" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Add a list of document json objects into the database</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>doc_list</code></td>
            <td>
                  <code>list of json objects</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>what is returned from an API call for
documents</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>print_statements</code></td>
            <td>
                  <code>boolean</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>whether to print info on progress</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_documents_to_db</span><span class="p">(</span>
    <span class="n">doc_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">],</span> <span class="n">print_statements</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a list of document json objects into the database</span>

<span class="sd">    Args:</span>
<span class="sd">        doc_list (list of json objects): what is returned from an API call for</span>
<span class="sd">            documents</span>
<span class="sd">        print_statements (boolean): whether to print info on progress</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">doc_list</span><span class="p">:</span>
        <span class="n">document_id</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">commentable</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;openForComment&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">commentable</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="ow">not</span> <span class="n">verify_database_existence</span><span class="p">(</span><span class="s2">&quot;regulations_document&quot;</span><span class="p">,</span> <span class="n">document_id</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="c1"># add this doc to the documents table in the database</span>
            <span class="n">full_doc_info</span> <span class="o">=</span> <span class="n">query_register_API_and_merge_document_data</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
            <span class="c1"># qa step</span>
            <span class="n">qa_document_data</span><span class="p">(</span><span class="n">full_doc_info</span><span class="p">)</span>

            <span class="c1"># clean step</span>
            <span class="n">clean_document_data</span><span class="p">(</span><span class="n">full_doc_info</span><span class="p">)</span>

            <span class="c1"># insert step</span>
            <span class="n">insert_response</span> <span class="o">=</span> <span class="n">insert_document_into_db</span><span class="p">(</span><span class="n">full_doc_info</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">insert_response</span><span class="p">[</span><span class="s2">&quot;error&quot;</span><span class="p">]:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">insert_response</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">])</span>
                <span class="c1"># would want to add logging here</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">print_statements</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;added document </span><span class="si">{</span><span class="n">document_id</span><span class="si">}</span><span class="s2"> to the db&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.check_CFR_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_CFR_data</span><span class="p">(</span><span class="n">document_data</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.check_CFR_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Check that the CFR field looks right</p>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_CFR_data</span><span class="p">(</span><span class="n">document_data</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check that the CFR field looks right</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;CFR&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="ow">or</span> <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;CFR&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Not Found&quot;</span>
            <span class="ow">or</span> <span class="s2">&quot;CFR&quot;</span> <span class="ow">in</span> <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;CFR&quot;</span><span class="p">]</span>
            <span class="ow">or</span> <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;CFR&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">AssertionError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.clean_comment_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clean_comment_data</span><span class="p">(</span><span class="n">comment_data</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.clean_comment_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Clean comment text -- make sure dates are formatted correctly</p>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clean_comment_data</span><span class="p">(</span><span class="n">comment_data</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clean comment text -- make sure dates are formatted correctly</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">comment_text_attributes</span> <span class="o">=</span> <span class="n">comment_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span>

    <span class="c1"># format the date fields</span>
    <span class="k">for</span> <span class="n">date_field</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;modifyDate&quot;</span><span class="p">,</span> <span class="s2">&quot;postedDate&quot;</span><span class="p">,</span> <span class="s2">&quot;receiveDate&quot;</span><span class="p">]:</span>
        <span class="n">comment_text_attributes</span><span class="p">[</span><span class="n">date_field</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span>
                <span class="n">comment_text_attributes</span><span class="p">[</span><span class="n">date_field</span><span class="p">],</span> <span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">T%H:%M:%SZ&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">comment_text_attributes</span><span class="p">[</span><span class="n">date_field</span><span class="p">]</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

    <span class="c1"># clean the text</span>
    <span class="k">if</span> <span class="n">comment_text_attributes</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">comment_text_attributes</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_text</span><span class="p">(</span>
            <span class="n">comment_text_attributes</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">]</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.clean_document_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">clean_document_data</span><span class="p">(</span><span class="n">document_data</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.clean_document_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Clean document data in place; run cleaning code on summary</p>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">clean_document_data</span><span class="p">(</span><span class="n">document_data</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clean document data in place; run cleaning code on summary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;summary&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;summary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clean_text</span><span class="p">(</span><span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;summary&quot;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.connect_db_and_get_cursor" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">connect_db_and_get_cursor</span><span class="p">()</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.connect_db_and_get_cursor" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Connect to the CivicLens database and return the objects</p>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">connect_db_and_get_cursor</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">(</span>
    <span class="nb">tuple</span><span class="p">[</span><span class="n">psycopg2</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">connection</span><span class="p">,</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">extensions</span><span class="o">.</span><span class="n">cursor</span><span class="p">]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Connect to the CivicLens database and return the objects</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">connection</span> <span class="o">=</span> <span class="n">psycopg2</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
        <span class="n">database</span><span class="o">=</span><span class="n">DATABASE_NAME</span><span class="p">,</span>
        <span class="n">user</span><span class="o">=</span><span class="n">DATABASE_USER</span><span class="p">,</span>
        <span class="n">password</span><span class="o">=</span><span class="n">DATABASE_PASSWORD</span><span class="p">,</span>
        <span class="n">host</span><span class="o">=</span><span class="n">DATABASE_HOST</span><span class="p">,</span>
        <span class="n">port</span><span class="o">=</span><span class="n">DATABASE_PORT</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">cursor</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">connection</span><span class="p">,</span> <span class="n">cursor</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.extract_xml_text_from_doc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_xml_text_from_doc</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.extract_xml_text_from_doc" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Take a document's json object, pull the xml text, add the text to the
object</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>doc</code></td>
            <td>
                  <code>json</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the object from regulations.gov API</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>processed_data</code></td>            <td>
                  <code>json</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the object with added text</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">extract_xml_text_from_doc</span><span class="p">(</span><span class="n">doc</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">json</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Take a document&#39;s json object, pull the xml text, add the text to the</span>
<span class="sd">    object</span>

<span class="sd">    Args:</span>
<span class="sd">        doc (json): the object from regulations.gov API</span>

<span class="sd">    Returns:</span>
<span class="sd">        processed_data (json): the object with added text</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">processed_data</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">doc</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">processed_data</span>

    <span class="n">fr_doc_num</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;frDocNum&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">fr_doc_num</span><span class="p">:</span>
        <span class="n">xml_url</span> <span class="o">=</span> <span class="n">fetch_fr_document_details</span><span class="p">(</span><span class="n">fr_doc_num</span><span class="p">)</span>
        <span class="n">xml_content</span> <span class="o">=</span> <span class="n">fetch_xml_content</span><span class="p">(</span><span class="n">xml_url</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xml_content</span><span class="p">:</span>
            <span class="n">extracted_data</span> <span class="o">=</span> <span class="n">parse_xml_content</span><span class="p">(</span><span class="n">xml_content</span><span class="p">)</span>
            <span class="n">processed_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span><span class="o">**</span><span class="n">doc</span><span class="p">,</span> <span class="o">**</span><span class="n">extracted_data</span><span class="p">}</span>
            <span class="p">)</span>  <span class="c1"># merge the json objects</span>

    <span class="k">return</span> <span class="n">processed_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.fetch_fr_document_details" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fetch_fr_document_details</span><span class="p">(</span><span class="n">fr_doc_num</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.fetch_fr_document_details" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Retrieves xml url for document text from federal register.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>fr_doc_num</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the unique id (comes from regulations.gov api info)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xml url (str)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fetch_fr_document_details</span><span class="p">(</span><span class="n">fr_doc_num</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves xml url for document text from federal register.</span>

<span class="sd">    Args:</span>
<span class="sd">        fr_doc_num (str): the unique id (comes from regulations.gov api info)</span>

<span class="sd">    Returns:</span>
<span class="sd">        xml url (str)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api_endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://www.federalregister.gov/api/v1/documents/</span><span class="si">{</span><span class="n">fr_doc_num</span><span class="si">}</span><span class="s2">.json?fields[]=full_text_xml_url&quot;</span>  <span class="c1"># noqa: E231</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">api_endpoint</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;full_text_xml_url&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Error fetching FR document details for </span><span class="si">{</span><span class="n">fr_doc_num</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># noqa: E501</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.fetch_xml_content" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fetch_xml_content</span><span class="p">(</span><span class="n">url</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.fetch_xml_content" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Fetches XML content from a given URL.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>url</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the xml url that we want to retrive text from</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>response.text (str): the text</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fetch_xml_content</span><span class="p">(</span><span class="n">url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetches XML content from a given URL.</span>

<span class="sd">    Args:</span>
<span class="sd">        url (str): the xml url that we want to retrive text from</span>

<span class="sd">    Returns:</span>
<span class="sd">        response.text (str): the text</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">text</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Error fetching XML content from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.get_comment_text" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_comment_text</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span> <span class="n">comment_id</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.get_comment_text" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Get the text of a comment, with retry logic to handle rate limits.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>api_key</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>key for the regulations.gov API</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>comment_id</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the id for the comment</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>json object for the comment text</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_comment_text</span><span class="p">(</span><span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">comment_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the text of a comment, with retry logic to handle rate limits.</span>

<span class="sd">    Args:</span>
<span class="sd">        api_key (str): key for the regulations.gov API</span>
<span class="sd">        comment_id (str): the id for the comment</span>

<span class="sd">    Returns:</span>
<span class="sd">        json object for the comment text</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">api_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.regulations.gov/v4/comments/&quot;</span>
    <span class="n">endpoint</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">api_url</span><span class="si">}{</span><span class="n">comment_id</span><span class="si">}</span><span class="s2">?include=attachments&quot;</span>

    <span class="n">STATUS_CODE_OVER_RATE_LIMIT</span> <span class="o">=</span> <span class="mi">429</span>
    <span class="n">WAIT_SECONDS</span> <span class="o">=</span> <span class="mi">3600</span>  <span class="c1"># Default to 1 hour</span>

    <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="n">session</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s2">&quot;https&quot;</span><span class="p">,</span> <span class="n">HTTPAdapter</span><span class="p">(</span><span class="n">max_retries</span><span class="o">=</span><span class="mi">4</span><span class="p">))</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="n">endpoint</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;X-Api-Key&quot;</span><span class="p">:</span> <span class="n">api_key</span><span class="p">},</span> <span class="n">verify</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="c1"># SUCCESS! Return the JSON of the request</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="n">STATUS_CODE_OVER_RATE_LIMIT</span><span class="p">:</span>
            <span class="n">retry_after</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Retry-After&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">wait_time</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">retry_after</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">retry_after</span> <span class="ow">and</span> <span class="n">retry_after</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
                <span class="k">else</span> <span class="n">WAIT_SECONDS</span>
            <span class="p">)</span>
            <span class="n">the_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Rate limit exceeded at </span><span class="si">{</span><span class="n">the_time</span><span class="si">}</span><span class="s2">.</span>
<span class="s2">                Waiting </span><span class="si">{</span><span class="n">wait_time</span><span class="si">}</span><span class="s2"> seconds to retry.&quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Failed to retrieve comment data.</span>
<span class="s2">                Status code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.get_most_recent_doc_comment_date" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_most_recent_doc_comment_date</span><span class="p">(</span><span class="n">doc_id</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.get_most_recent_doc_comment_date" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Returns the date of the most recent comment for a doc</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>doc_id</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the regulations.gov doc id</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>response</code></td>            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the most recent date</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_most_recent_doc_comment_date</span><span class="p">(</span><span class="n">doc_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the date of the most recent comment for a doc</span>

<span class="sd">    Args:</span>
<span class="sd">        doc_id (str): the regulations.gov doc id</span>

<span class="sd">    Returns:</span>
<span class="sd">        response (datetime): the most recent date</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">connection</span><span class="p">,</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">connect_db_and_get_cursor</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">connection</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;SELECT MAX(&quot;posted_date&quot;)</span>
<span class="s2">                FROM regulations_comment</span>
<span class="s2">                WHERE &quot;document_id&quot; = &#39;</span><span class="si">{</span><span class="n">doc_id</span><span class="si">}</span><span class="s2">&#39;;&quot;&quot;&quot;</span>  <span class="c1"># noqa: E231, E702</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="c1"># format the text</span>
    <span class="c1"># it seems that the regulations.gov API returns postedDate rounded to the</span>
    <span class="c1"># hour. If we used that naively as the most recent date, we might miss some</span>
    <span class="c1"># comments when we pull comments again. By backing up one hour, we trade</span>
    <span class="c1"># off some unnecessary API calls for ensuring we don&#39;t miss anything</span>
    <span class="n">date_dt</span> <span class="o">=</span> <span class="n">response</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">one_hour_prior</span> <span class="o">=</span> <span class="n">date_dt</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">most_recent_date</span> <span class="o">=</span> <span class="n">one_hour_prior</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">most_recent_date</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.insert_comment_into_db" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">insert_comment_into_db</span><span class="p">(</span><span class="n">comment_data</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.insert_comment_into_db" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Insert the info on a comment into the PublicComments table</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>comment_data</code></td>
            <td>
                  <code>json</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the comment info from regulations.gov API</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>nothing unless an error; adds the info into the table</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">insert_comment_into_db</span><span class="p">(</span><span class="n">comment_data</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert the info on a comment into the PublicComments table</span>

<span class="sd">    Args:</span>
<span class="sd">        comment_data (json): the comment info from regulations.gov API</span>

<span class="sd">    Returns:</span>
<span class="sd">        nothing unless an error; adds the info into the table</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">connection</span><span class="p">,</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">connect_db_and_get_cursor</span><span class="p">()</span>

    <span class="n">attributes</span> <span class="o">=</span> <span class="n">comment_data</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span>
    <span class="n">comment_text_attributes</span> <span class="o">=</span> <span class="n">comment_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span>

    <span class="c1"># Map JSON attributes to corresponding table columns</span>
    <span class="n">comment_id</span> <span class="o">=</span> <span class="n">comment_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
    <span class="n">objectId</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;objectId&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">commentOn</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;commentOn&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">document_id</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;commentOnDocumentId&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">duplicateComments</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;duplicateComments&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">stateProvinceRegion</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;stateProvinceRegion&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">subtype</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subtype&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">comment</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">firstName</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;firstName&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">lastName</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;lastName&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">address1</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;address1&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">address2</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;address2&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">city</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;city&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">category</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;category&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">country</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;country&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">phone</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;phone&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">govAgency</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;govAgency&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">govAgencyType</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;govAgencyType&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">organization</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;organization&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">originalDocumentId</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;originalDocumentId&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">modifyDate</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;modifyDate&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">pageCount</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pageCount&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">postedDate</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;postedDate&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">receiveDate</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;receiveDate&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">trackingNbr</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;trackingNbr&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">withdrawn</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;withdrawn&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">reasonWithdrawn</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;reasonWithdrawn&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">zip</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;zip&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">restrictReason</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;restrictReason&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">restrictReasonType</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;restrictReasonType&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">submitterRep</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;submitterRep&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">submitterRepAddress</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;submitterRepAddress&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">submitterRepCityState</span> <span class="o">=</span> <span class="n">comment_text_attributes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="s2">&quot;submitterRepCityState&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>
    <span class="p">)</span>

    <span class="c1"># SQL INSERT statement</span>
    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">    INSERT INTO regulations_comment (</span>
<span class="s2">        &quot;id&quot;,</span>
<span class="s2">        &quot;object_id&quot;,</span>
<span class="s2">        &quot;comment_on&quot;,</span>
<span class="s2">        &quot;document_id&quot;,</span>
<span class="s2">        &quot;duplicate_comments&quot;,</span>
<span class="s2">        &quot;state_province_region&quot;,</span>
<span class="s2">        &quot;subtype&quot;,</span>
<span class="s2">        &quot;comment&quot;,</span>
<span class="s2">        &quot;first_name&quot;,</span>
<span class="s2">        &quot;last_name&quot;,</span>
<span class="s2">        &quot;address1&quot;,</span>
<span class="s2">        &quot;address2&quot;,</span>
<span class="s2">        &quot;city&quot;,</span>
<span class="s2">        &quot;category&quot;,</span>
<span class="s2">        &quot;country&quot;,</span>
<span class="s2">        &quot;email&quot;,</span>
<span class="s2">        &quot;phone&quot;,</span>
<span class="s2">        &quot;gov_agency&quot;,</span>
<span class="s2">        &quot;gov_agency_type&quot;,</span>
<span class="s2">        &quot;organization&quot;,</span>
<span class="s2">        &quot;original_document_id&quot;,</span>
<span class="s2">        &quot;modify_date&quot;,</span>
<span class="s2">        &quot;page_count&quot;,</span>
<span class="s2">        &quot;posted_date&quot;,</span>
<span class="s2">        &quot;receive_date&quot;,</span>
<span class="s2">        &quot;title&quot;,</span>
<span class="s2">        &quot;tracking_nbr&quot;,</span>
<span class="s2">        &quot;withdrawn&quot;,</span>
<span class="s2">        &quot;reason_withdrawn&quot;,</span>
<span class="s2">        &quot;zip&quot;,</span>
<span class="s2">        &quot;restrict_reason&quot;,</span>
<span class="s2">        &quot;restrict_reason_type&quot;,</span>
<span class="s2">        &quot;submitter_rep&quot;,</span>
<span class="s2">        &quot;submitter_rep_address&quot;,</span>
<span class="s2">        &quot;submitter_rep_city_state&quot;</span>
<span class="s2">    ) VALUES (</span>
<span class="s2">        </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">,</span>
<span class="s2">        </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span>
<span class="s2">    )</span>
<span class="s2">    ON CONFLICT (id) DO UPDATE SET</span>
<span class="s2">        object_id = EXCLUDED.object_id,</span>
<span class="s2">        comment_on = EXCLUDED.comment_on,</span>
<span class="s2">        document_id = EXCLUDED.document_id,</span>
<span class="s2">        duplicate_comments = EXCLUDED.duplicate_comments,</span>
<span class="s2">        state_province_region = EXCLUDED.state_province_region,</span>
<span class="s2">        subtype = EXCLUDED.subtype,</span>
<span class="s2">        comment = EXCLUDED.comment,</span>
<span class="s2">        first_name = EXCLUDED.first_name,</span>
<span class="s2">        last_name = EXCLUDED.last_name,</span>
<span class="s2">        address1 = EXCLUDED.address1,</span>
<span class="s2">        address2 = EXCLUDED.address2,</span>
<span class="s2">        city = EXCLUDED.city,</span>
<span class="s2">        category = EXCLUDED.category,</span>
<span class="s2">        country = EXCLUDED.country,</span>
<span class="s2">        email = EXCLUDED.email,</span>
<span class="s2">        phone = EXCLUDED.phone,</span>
<span class="s2">        gov_agency = EXCLUDED.gov_agency,</span>
<span class="s2">        gov_agency_type = EXCLUDED.gov_agency_type,</span>
<span class="s2">        organization = EXCLUDED.organization,</span>
<span class="s2">        original_document_id = EXCLUDED.original_document_id,</span>
<span class="s2">        modify_date = EXCLUDED.modify_date,</span>
<span class="s2">        page_count = EXCLUDED.page_count,</span>
<span class="s2">        posted_date = EXCLUDED.posted_date,</span>
<span class="s2">        receive_date = EXCLUDED.receive_date,</span>
<span class="s2">        title = EXCLUDED.title,</span>
<span class="s2">        tracking_nbr = EXCLUDED.tracking_nbr,</span>
<span class="s2">        withdrawn = EXCLUDED.withdrawn,</span>
<span class="s2">        reason_withdrawn = EXCLUDED.reason_withdrawn,</span>
<span class="s2">        zip = EXCLUDED.zip,</span>
<span class="s2">        restrict_reason = EXCLUDED.restrict_reason,</span>
<span class="s2">        restrict_reason_type = EXCLUDED.restrict_reason_type,</span>
<span class="s2">        submitter_rep = EXCLUDED.submitter_rep,</span>
<span class="s2">        submitter_rep_address = EXCLUDED.submitter_rep_address,</span>
<span class="s2">        submitter_rep_city_state = EXCLUDED.submitter_rep_city_state;</span>
<span class="s2">    &quot;&quot;&quot;</span>

    <span class="c1"># Execute the SQL statement</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">connection</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="n">query</span><span class="p">,</span>
                <span class="p">(</span>
                    <span class="n">comment_id</span><span class="p">,</span>
                    <span class="n">objectId</span><span class="p">,</span>
                    <span class="n">commentOn</span><span class="p">,</span>
                    <span class="n">document_id</span><span class="p">,</span>
                    <span class="n">duplicateComments</span><span class="p">,</span>
                    <span class="n">stateProvinceRegion</span><span class="p">,</span>
                    <span class="n">subtype</span><span class="p">,</span>
                    <span class="n">comment</span><span class="p">,</span>
                    <span class="n">firstName</span><span class="p">,</span>
                    <span class="n">lastName</span><span class="p">,</span>
                    <span class="n">address1</span><span class="p">,</span>
                    <span class="n">address2</span><span class="p">,</span>
                    <span class="n">city</span><span class="p">,</span>
                    <span class="n">category</span><span class="p">,</span>
                    <span class="n">country</span><span class="p">,</span>
                    <span class="n">email</span><span class="p">,</span>
                    <span class="n">phone</span><span class="p">,</span>
                    <span class="n">govAgency</span><span class="p">,</span>
                    <span class="n">govAgencyType</span><span class="p">,</span>
                    <span class="n">organization</span><span class="p">,</span>
                    <span class="n">originalDocumentId</span><span class="p">,</span>
                    <span class="n">modifyDate</span><span class="p">,</span>
                    <span class="n">pageCount</span><span class="p">,</span>
                    <span class="n">postedDate</span><span class="p">,</span>
                    <span class="n">receiveDate</span><span class="p">,</span>
                    <span class="n">title</span><span class="p">,</span>
                    <span class="n">trackingNbr</span><span class="p">,</span>
                    <span class="n">withdrawn</span><span class="p">,</span>
                    <span class="n">reasonWithdrawn</span><span class="p">,</span>
                    <span class="nb">zip</span><span class="p">,</span>
                    <span class="n">restrictReason</span><span class="p">,</span>
                    <span class="n">restrictReasonType</span><span class="p">,</span>
                    <span class="n">submitterRep</span><span class="p">,</span>
                    <span class="n">submitterRepAddress</span><span class="p">,</span>
                    <span class="n">submitterRepCityState</span><span class="p">,</span>
                <span class="p">),</span>
            <span class="p">)</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Error inserting comment </span><span class="si">{</span><span class="n">comment_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> into</span>
<span class="s2">        comment table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">error_message</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.insert_docket_into_db" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">insert_docket_into_db</span><span class="p">(</span><span class="n">docket_data</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.insert_docket_into_db" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Run assert statements to check docket data looks right</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>docket_data</code></td>
            <td>
                  <code>json</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the docket info from regulations.gov API</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Returns: nothing unless an error; adds the info into the table</p>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">insert_docket_into_db</span><span class="p">(</span><span class="n">docket_data</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run assert statements to check docket data looks right</span>

<span class="sd">    Args:</span>
<span class="sd">        docket_data (json): the docket info from regulations.gov API</span>

<span class="sd">    Returns: nothing unless an error; adds the info into the table</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data_for_db</span> <span class="o">=</span> <span class="n">docket_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="n">data_for_db</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span><span class="p">,</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">connect_db_and_get_cursor</span><span class="p">()</span>

        <span class="k">with</span> <span class="n">connection</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
<span class="w">                    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">                    INSERT INTO regulations_docket (</span>
<span class="sd">                        &quot;id&quot;,</span>
<span class="sd">                        &quot;docket_type&quot;,</span>
<span class="sd">                        &quot;last_modified_date&quot;,</span>
<span class="sd">                        &quot;agency_id&quot;,</span>
<span class="sd">                        &quot;title&quot;,</span>
<span class="sd">                        &quot;object_id&quot;,</span>
<span class="sd">                        &quot;highlighted_content&quot;</span>
<span class="sd">                    ) VALUES (</span>
<span class="sd">                        %s, %s, %s, %s, %s, %s, %s</span>
<span class="sd">                    )</span>
<span class="sd">                    ON CONFLICT (id) DO UPDATE SET</span>
<span class="sd">                        docket_type = EXCLUDED.docket_type,</span>
<span class="sd">                        last_modified_date = EXCLUDED.last_modified_date,</span>
<span class="sd">                        agency_id = EXCLUDED.agency_id,</span>
<span class="sd">                        title = EXCLUDED.title,</span>
<span class="sd">                        object_id = EXCLUDED.object_id,</span>
<span class="sd">                        highlighted_content = EXCLUDED.highlighted_content;</span>
<span class="sd">                    &quot;&quot;&quot;</span><span class="p">,</span>
                    <span class="p">(</span>
                        <span class="n">data_for_db</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
                        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;docketType&quot;</span><span class="p">],</span>
                        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;lastModifiedDate&quot;</span><span class="p">],</span>
                        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;agencyId&quot;</span><span class="p">],</span>
                        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
                        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;objectId&quot;</span><span class="p">],</span>
                        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;highlightedContent&quot;</span><span class="p">],</span>
                    <span class="p">),</span>
                <span class="p">)</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Error inserting docket </span><span class="si">{</span><span class="n">data_for_db</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span><span class="si">}</span>
<span class="s2">        into dockets table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">error_message</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.insert_document_into_db" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">insert_document_into_db</span><span class="p">(</span><span class="n">document_data</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.insert_document_into_db" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Insert the info on a document into the documents table</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>document_data</code></td>
            <td>
                  <code>json</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the document info from regulations.gov API</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>nothing unless an error; adds the info into the table</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">insert_document_into_db</span><span class="p">(</span><span class="n">document_data</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Insert the info on a document into the documents table</span>

<span class="sd">    Args:</span>
<span class="sd">        document_data (json): the document info from regulations.gov API</span>

<span class="sd">    Returns:</span>
<span class="sd">        nothing unless an error; adds the info into the table</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">attributes</span> <span class="o">=</span> <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span>

    <span class="n">fields_to_insert</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">],</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;documentType&quot;</span><span class="p">],</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;lastModifiedDate&quot;</span><span class="p">],</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;frDocNum&quot;</span><span class="p">],</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;withdrawn&quot;</span><span class="p">],</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;agencyId&quot;</span><span class="p">],</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;commentEndDate&quot;</span><span class="p">],</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;postedDate&quot;</span><span class="p">],</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;docketId&quot;</span><span class="p">],</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;subtype&quot;</span><span class="p">],</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;commentStartDate&quot;</span><span class="p">],</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;openForComment&quot;</span><span class="p">],</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;objectId&quot;</span><span class="p">],</span>
        <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">][</span><span class="s2">&quot;self&quot;</span><span class="p">],</span>
        <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;agencyType&quot;</span><span class="p">],</span>
        <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;CFR&quot;</span><span class="p">],</span>
        <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;RIN&quot;</span><span class="p">],</span>
        <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span>
        <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;summary&quot;</span><span class="p">],</span>
        <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;dates&quot;</span><span class="p">],</span>
        <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;furtherInformation&quot;</span><span class="p">],</span>
        <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;supplementaryInformation&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;INSERT INTO regulations_document (&quot;id&quot;,</span>
<span class="s2">                            &quot;document_type&quot;,</span>
<span class="s2">                            &quot;last_modified_date&quot;,</span>
<span class="s2">                            &quot;fr_doc_num&quot;,</span>
<span class="s2">                            &quot;withdrawn&quot;,</span>
<span class="s2">                            &quot;agency_id&quot;,</span>
<span class="s2">                            &quot;comment_end_date&quot;,</span>
<span class="s2">                            &quot;posted_date&quot;,</span>
<span class="s2">                            &quot;docket_id&quot;,</span>
<span class="s2">                            &quot;subtype&quot;,</span>
<span class="s2">                            &quot;comment_start_date&quot;,</span>
<span class="s2">                            &quot;open_for_comment&quot;,</span>
<span class="s2">                            &quot;object_id&quot;,</span>
<span class="s2">                            &quot;full_text_xml_url&quot;,</span>
<span class="s2">                            &quot;agency_type&quot;,</span>
<span class="s2">                            &quot;cfr&quot;,</span>
<span class="s2">                            &quot;rin&quot;,</span>
<span class="s2">                            &quot;title&quot;,</span>
<span class="s2">                            &quot;summary&quot;,</span>
<span class="s2">                            &quot;dates&quot;,</span>
<span class="s2">                            &quot;further_information&quot;,</span>
<span class="s2">                            &quot;supplementary_information&quot;) </span><span class="se">\</span>
<span class="s2">                    VALUES (</span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">,</span>
<span class="s2">                        </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">, </span><span class="si">%s</span><span class="s2">)</span>
<span class="s2">                    ON CONFLICT (id) DO UPDATE SET</span>
<span class="s2">                        document_type = EXCLUDED.document_type,</span>
<span class="s2">                        last_modified_date = EXCLUDED.last_modified_date,</span>
<span class="s2">                        fr_doc_num = EXCLUDED.fr_doc_num,</span>
<span class="s2">                        withdrawn = EXCLUDED.withdrawn,</span>
<span class="s2">                        agency_id = EXCLUDED.agency_id,</span>
<span class="s2">                        comment_end_date = EXCLUDED.comment_end_date,</span>
<span class="s2">                        posted_date = EXCLUDED.posted_date,</span>
<span class="s2">                        docket_id = EXCLUDED.docket_id,</span>
<span class="s2">                        subtype = EXCLUDED.subtype,</span>
<span class="s2">                        comment_start_date = EXCLUDED.comment_start_date,</span>
<span class="s2">                        open_for_comment = EXCLUDED.open_for_comment,</span>
<span class="s2">                        object_id = EXCLUDED.object_id,</span>
<span class="s2">                        full_text_xml_url = EXCLUDED.full_text_xml_url,</span>
<span class="s2">                        agency_type = EXCLUDED.agency_type,</span>
<span class="s2">                        cfr = EXCLUDED.cfr,</span>
<span class="s2">                        rin = EXCLUDED.rin,</span>
<span class="s2">                        title = EXCLUDED.title,</span>
<span class="s2">                        summary = EXCLUDED.summary,</span>
<span class="s2">                        dates = EXCLUDED.dates,</span>
<span class="s2">                        further_information = EXCLUDED.further_information,</span>
<span class="s2">                        supplementary_information =</span>
<span class="s2">                        EXCLUDED.supplementary_information;&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">connection</span><span class="p">,</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">connect_db_and_get_cursor</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">connection</span><span class="p">:</span>
            <span class="k">with</span> <span class="n">cursor</span><span class="p">:</span>
                <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="n">query</span><span class="p">,</span>
                    <span class="n">fields_to_insert</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">connection</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">error_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Error inserting document</span>
<span class="s2">        </span><span class="si">{</span><span class="n">document_data</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> into dockets table: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">error_message</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">e</span><span class="p">,</span>
            <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="n">error_message</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;description&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.merge_comment_text_and_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge_comment_text_and_data</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span> <span class="n">comment_data</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.merge_comment_text_and_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Combine comment json object with the comment text json object</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>api_key</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>key for the regulations.gov API</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>comment_data</code></td>
            <td>
                  <code>json</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the json object from regulations.gov</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>json</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>combined json object for the comment and text</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">merge_comment_text_and_data</span><span class="p">(</span><span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">comment_data</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">json</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Combine comment json object with the comment text json object</span>

<span class="sd">    Args:</span>
<span class="sd">        api_key (str): key for the regulations.gov API</span>
<span class="sd">        comment_data (json): the json object from regulations.gov</span>

<span class="sd">    Returns:</span>
<span class="sd">        combined json object for the comment and text</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">comment_text_data</span> <span class="o">=</span> <span class="n">get_comment_text</span><span class="p">(</span><span class="n">api_key</span><span class="p">,</span> <span class="n">comment_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>

    <span class="c1"># DECISION: only track the comment data; don&#39;t include the info on comment</span>
    <span class="c1"># attachments which is found elsewhere in comment_text_data</span>

    <span class="n">all_comment_data</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">comment_data</span><span class="p">,</span> <span class="o">**</span><span class="n">comment_text_data</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">all_comment_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.parse_xml_content" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">parse_xml_content</span><span class="p">(</span><span class="n">xml_content</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.parse_xml_content" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Parses XML content and extracts relevant data such as agency type, CFR,
RIN, title, summary, etc.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>xml_content</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>xml formatted text</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>extracted_data</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>contains key parts of the extracted text</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">parse_xml_content</span><span class="p">(</span><span class="n">xml_content</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parses XML content and extracts relevant data such as agency type, CFR,</span>
<span class="sd">    RIN, title, summary, etc.</span>

<span class="sd">    Args:</span>
<span class="sd">        xml_content (str): xml formatted text</span>

<span class="sd">    Returns:</span>
<span class="sd">        extracted_data (dict): contains key parts of the extracted text</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert the XML string to an ElementTree object</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xml_content</span><span class="p">)</span>

    <span class="c1"># Initialize a dictionary to hold extracted data</span>
    <span class="n">extracted_data</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Extract Agency Type</span>
    <span class="n">agency_type</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.//AGENCY[@TYPE=&quot;S&quot;]&#39;</span><span class="p">)</span>
    <span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;agencyType&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">agency_type</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">agency_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;Not Found&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Extract CFR</span>
    <span class="n">cfr</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.//CFR&quot;</span><span class="p">)</span>
    <span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;CFR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cfr</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">cfr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;Not Found&quot;</span>

    <span class="c1"># Extract RIN</span>
    <span class="n">rin</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.//RIN&quot;</span><span class="p">)</span>
    <span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;RIN&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rin</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">rin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;Not Found&quot;</span>

    <span class="c1"># Extract Title (Subject)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.//SUBJECT&quot;</span><span class="p">)</span>
    <span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">title</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;Not Found&quot;</span>

    <span class="c1"># Extract Summary</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.//SUM/P&quot;</span><span class="p">)</span>
    <span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;summary&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">summary</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">summary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;Not Found&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Extract DATES</span>
    <span class="n">dates</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.//DATES/P&quot;</span><span class="p">)</span>
    <span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;dates&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dates</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">dates</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;Not Found&quot;</span>

    <span class="c1"># Extract Further Information</span>
    <span class="n">furinf</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.//FURINF/P&quot;</span><span class="p">)</span>
    <span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;furtherInformation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">furinf</span><span class="o">.</span><span class="n">text</span> <span class="k">if</span> <span class="n">furinf</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;Not Found&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Extract Supplementary Information</span>
    <span class="n">supl_info_texts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">supl_info_elements</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;.//SUPLINF/*&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">supl_info_elements</span><span class="p">:</span>
        <span class="c1"># Assuming we want to gather all text from children tags within</span>
        <span class="c1"># &lt;SUPLINF&gt;</span>
        <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">supl_info_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">for</span> <span class="n">sub_element</span> <span class="ow">in</span> <span class="n">element</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sub_element</span><span class="o">.</span><span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">supl_info_texts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sub_element</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

    <span class="c1"># Join all pieces of supplementary information text into a single string</span>
    <span class="n">extracted_data</span><span class="p">[</span><span class="s2">&quot;supplementaryInformation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">supl_info_texts</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">extracted_data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.pull_all_api_data_for_date_range" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pull_all_api_data_for_date_range</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">pull_dockets</span><span class="p">,</span> <span class="n">pull_documents</span><span class="p">,</span> <span class="n">pull_comments</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.pull_all_api_data_for_date_range" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Pull different types of data from regulations.gov API based on date range</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>start_date</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the date in YYYY-MM-DD format to pull data from
(inclusive)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>end_date</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the date in YYYY-MM-DD format to stop the data pull
(inclusive)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pull_dockets</code></td>
            <td>
                  <code>boolean</code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None; adds data to the db</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span>
<span class="normal">1333</span>
<span class="normal">1334</span>
<span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">pull_all_api_data_for_date_range</span><span class="p">(</span>
    <span class="n">start_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">end_date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">pull_dockets</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">pull_documents</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">pull_comments</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Pull different types of data from regulations.gov API based on date range</span>

<span class="sd">    Args:</span>
<span class="sd">        start_date (str): the date in YYYY-MM-DD format to pull data from</span>
<span class="sd">            (inclusive)</span>
<span class="sd">        end_date (str): the date in YYYY-MM-DD format to stop the data pull</span>
<span class="sd">            (inclusive)</span>
<span class="sd">        pull_dockets (boolean):</span>

<span class="sd">    Returns:</span>
<span class="sd">        None; adds data to the db</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># get documents</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;getting list of documents within date range&quot;</span><span class="p">)</span>
    <span class="n">doc_list</span> <span class="o">=</span> <span class="n">pull_reg_gov_data</span><span class="p">(</span>
        <span class="n">REG_GOV_API_KEY</span><span class="p">,</span>
        <span class="s2">&quot;documents&quot;</span><span class="p">,</span>
        <span class="n">start_date</span><span class="o">=</span><span class="n">start_date</span><span class="p">,</span>
        <span class="n">end_date</span><span class="o">=</span><span class="n">end_date</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;got </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">doc_list</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents&quot;</span><span class="p">)</span>
    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;now extracting docs open for comments from that list&quot;</span><span class="p">)</span>

    <span class="c1"># pull the commentable docs from that list</span>
    <span class="n">commentable_docs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="n">doc_list</span><span class="p">:</span>
        <span class="n">docket_id</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;docketId&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">docket_id</span> <span class="ow">and</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">][</span><span class="s2">&quot;openForComment&quot;</span><span class="p">]:</span>
            <span class="n">commentable_docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
            <span class="c1"># can&#39;t add this doc to the db right now because docket needs to be</span>
            <span class="c1"># added first</span>
            <span class="c1"># the db needs the docket primary key first</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">commentable_docs</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents open for comment&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pull_dockets</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;getting dockets associated with the documents open for comment&quot;</span>
        <span class="p">)</span>
        <span class="n">add_dockets_to_db</span><span class="p">(</span><span class="n">commentable_docs</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;no more dockets to add to db&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pull_documents</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;adding documents to the db&quot;</span><span class="p">)</span>
        <span class="n">add_documents_to_db</span><span class="p">(</span><span class="n">commentable_docs</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;no more documents to add to db&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">pull_comments</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;adding comments to the db&quot;</span><span class="p">)</span>
        <span class="n">add_comments_based_on_comment_date_range</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;no more comments to add to db&quot;</span><span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;process finished&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.qa_comment_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">qa_comment_data</span><span class="p">(</span><span class="n">comment_data</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.qa_comment_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Run assert statements to check comment data looks right</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>comment_data</code></td>
            <td>
                  <code>json object</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the document data from the API</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Returns: (bool) whether data is in the expected format</p>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">qa_comment_data</span><span class="p">(</span><span class="n">comment_data</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run assert statements to check comment data looks right</span>

<span class="sd">    Args:</span>
<span class="sd">        comment_data (json object): the document data from the API</span>

<span class="sd">    Returns: (bool) whether data is in the expected format</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">attributes</span> <span class="o">=</span> <span class="n">comment_data</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span>
    <span class="n">comment_text_attributes</span> <span class="o">=</span> <span class="n">comment_data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">comment_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">255</span><span class="p">,</span> <span class="s2">&quot;id is more than 255 characters&quot;</span>

        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;objectId&quot;</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;09&quot;</span>
        <span class="p">),</span> <span class="s2">&quot;objectId does not start with &#39;09&#39;&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">comment_text_attributes</span><span class="p">[</span><span class="s2">&quot;commentOn&quot;</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;09&quot;</span>
        <span class="p">),</span> <span class="s2">&quot;commentOn does not start with &#39;09&#39;&quot;</span>
        <span class="c1"># comment_data[&quot;commentOnDocumentId&quot;]</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">comment_text_attributes</span><span class="p">[</span><span class="s2">&quot;duplicateComments&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="p">),</span> <span class="s2">&quot;duplicateComments != 0&quot;</span>
        <span class="c1"># assert comment_data[&quot;stateProvinceRegion&quot;]</span>
        <span class="k">assert</span> <span class="n">comment_text_attributes</span><span class="p">[</span>
            <span class="s2">&quot;subtype&quot;</span>
        <span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">comment_text_attributes</span><span class="p">[</span><span class="s2">&quot;subtype&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;Public Comment&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Comment(s)&quot;</span><span class="p">,</span>
        <span class="p">],</span> <span class="s2">&quot;subtype is not an expected value&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">comment_text_attributes</span><span class="p">[</span><span class="s2">&quot;comment&quot;</span><span class="p">],</span> <span class="nb">str</span>
        <span class="p">),</span> <span class="s2">&quot;comment is not string&quot;</span>
        <span class="c1"># comment_data[&quot;firstName&quot;]</span>
        <span class="c1"># comment_data[&quot;lastName&quot;]</span>
        <span class="c1"># comment_data[&quot;address1&quot;]</span>
        <span class="c1"># comment_data[&quot;address2&quot;]</span>
        <span class="c1"># comment_data[&quot;city&quot;]</span>
        <span class="c1"># comment_data[&quot;category&quot;]</span>
        <span class="c1"># comment_data[&quot;country&quot;]</span>
        <span class="c1"># comment_data[&quot;email&quot;]</span>
        <span class="c1"># comment_data[&quot;phone&quot;]</span>
        <span class="c1"># comment_data[&quot;govAgency&quot;]</span>
        <span class="c1"># comment_data[&quot;govAgencyType&quot;]</span>
        <span class="c1"># comment_data[&quot;organization&quot;]</span>
        <span class="c1"># comment_data[&quot;originalDocumentId&quot;]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">comment_text_attributes</span><span class="p">[</span><span class="s2">&quot;modifyDate&quot;</span><span class="p">],</span> <span class="n">datetime</span>
        <span class="p">),</span> <span class="s2">&quot;modifyDate is not datetime&quot;</span>
        <span class="c1"># comment_data[&quot;pageCount&quot;]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">comment_text_attributes</span><span class="p">[</span><span class="s2">&quot;postedDate&quot;</span><span class="p">],</span> <span class="n">datetime</span>
        <span class="p">),</span> <span class="s2">&quot;postedDate is not datetime&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">comment_text_attributes</span><span class="p">[</span><span class="s2">&quot;receiveDate&quot;</span><span class="p">],</span> <span class="n">datetime</span>
        <span class="p">),</span> <span class="s2">&quot;receiveDate is not datetime&quot;</span>
        <span class="c1"># comment_data[&quot;trackingNbr&quot;]</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">comment_text_attributes</span><span class="p">[</span><span class="s2">&quot;withdrawn&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span>
        <span class="p">),</span> <span class="s2">&quot;withdrawn is not False&quot;</span>
        <span class="c1"># comment_data[&quot;reasonWithdrawn&quot;]</span>
        <span class="c1"># comment_data[&quot;zip&quot;]</span>
        <span class="c1"># comment_data[&quot;restrictReason&quot;]</span>
        <span class="c1"># comment_data[&quot;restrictReasonType&quot;]</span>
        <span class="c1"># comment_data[&quot;submitterRep&quot;]</span>
        <span class="c1"># comment_data[&quot;submitterRepAddress&quot;]</span>
        <span class="c1"># comment_data[&quot;submitterRepCityState&quot;]</span>

    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">comment_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AssertionError: comment </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> -- </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">add_data_quality_flag</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="s2">&quot;comment&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.qa_docket_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">qa_docket_data</span><span class="p">(</span><span class="n">docket_data</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.qa_docket_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Run assert statements to check docket data looks right</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>docket_data</code></td>
            <td>
                  <code>json object</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the docket data from the API</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Returns: (bool) whether data is in the expected format</p>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">qa_docket_data</span><span class="p">(</span><span class="n">docket_data</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run assert statements to check docket data looks right</span>

<span class="sd">    Args:</span>
<span class="sd">        docket_data (json object): the docket data from the API</span>

<span class="sd">    Returns: (bool) whether data is in the expected format</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">attributes</span> <span class="o">=</span> <span class="n">docket_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span>
    <span class="n">data_for_db</span> <span class="o">=</span> <span class="n">docket_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># need to check that docket_data is in the right format</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">isinstance</span><span class="p">(</span><span class="n">docket_data</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">docket_data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span>
        <span class="p">),</span> <span class="s2">&quot;docket data in wrong format&quot;</span>

        <span class="k">assert</span> <span class="s2">&quot;attributes&quot;</span> <span class="ow">in</span> <span class="n">data_for_db</span><span class="p">,</span> <span class="s2">&quot;&#39;attributes&#39; not in docket_data&quot;</span>

        <span class="c1"># check the fields</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">data_for_db</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">255</span>
        <span class="p">),</span> <span class="s2">&quot;id field longer than 255 characters&quot;</span>
        <span class="k">assert</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;docketType&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;Rulemaking&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Nonrulemaking&quot;</span><span class="p">,</span>
        <span class="p">],</span> <span class="s2">&quot;docketType unexpected value&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;lastModifiedDate&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">20</span>
            <span class="ow">and</span> <span class="s2">&quot;202&quot;</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;lastModifiedDate&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;lastModifiedDate is unexpected length&quot;</span>
        <span class="k">assert</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;agencyId&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">(),</span> <span class="s2">&quot;agencyId is not just letter&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">&quot;title is not string&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;objectId&quot;</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;0b&quot;</span>
        <span class="p">),</span> <span class="s2">&quot;objectId does not start with &#39;0b&#39;&quot;</span>
        <span class="c1"># attributes[&quot;highlightedContent&quot;]</span>

    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">data_for_db</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AssertionError: docket </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> -- </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">add_data_quality_flag</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="s2">&quot;docket&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.qa_document_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">qa_document_data</span><span class="p">(</span><span class="n">document_data</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.qa_document_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Run assert statements to check document data looks right</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>document_data</code></td>
            <td>
                  <code>json object</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the document data from the API</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>
      <p>Returns: (bool) whether data is in the expected format</p>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">qa_document_data</span><span class="p">(</span><span class="n">document_data</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">True</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run assert statements to check document data looks right</span>

<span class="sd">    Args:</span>
<span class="sd">        document_data (json object): the document data from the API</span>

<span class="sd">    Returns: (bool) whether data is in the expected format</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">attributes</span> <span class="o">=</span> <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span> <span class="o">&lt;</span> <span class="mi">255</span>
        <span class="k">assert</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;documentType&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="s2">&quot;Proposed Rule&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Other&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Notice&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Not Found&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Rule&quot;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="c1"># attributes[&quot;lastModifiedDate&quot;]</span>
        <span class="k">assert</span> <span class="n">validate_fr_doc_num</span><span class="p">(</span>
            <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;frDocNum&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;frDocNum contains unexpected characters or is None&quot;</span>
        <span class="k">assert</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;withdrawn&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;withdrawn is True&quot;</span>
        <span class="c1"># attributes[&quot;agencyId&quot;]</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">((</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;commentEndDate&quot;</span><span class="p">]))</span> <span class="o">==</span> <span class="mi">20</span>
            <span class="ow">and</span> <span class="s2">&quot;202&quot;</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;commentEndDate&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;commentEndDate is unexpected length&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;postedDate&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">20</span>
        <span class="p">),</span> <span class="s2">&quot;postedDate is unexpected length&quot;</span>
        <span class="c1"># attributes[&quot;docketId&quot;]</span>
        <span class="c1"># attributes[&quot;subtype&quot;]</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="nb">len</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;commentStartDate&quot;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">20</span>
            <span class="ow">and</span> <span class="s2">&quot;202&quot;</span> <span class="ow">in</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;commentStartDate&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;commentStartDate is expected length&quot;</span>
        <span class="k">assert</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;openForComment&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;openForComment is False&quot;</span>
        <span class="c1"># attributes[&quot;objectId&quot;]</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;https&quot;</span> <span class="ow">in</span> <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">][</span><span class="s2">&quot;self&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;&#39;https&#39; is not in document_data[&#39;links&#39;][&#39;self&#39;]&quot;</span>
        <span class="k">assert</span> <span class="p">(</span>
            <span class="s2">&quot;.gov&quot;</span> <span class="ow">in</span> <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;links&quot;</span><span class="p">][</span><span class="s2">&quot;self&quot;</span><span class="p">]</span>
        <span class="p">),</span> <span class="s2">&quot;&#39;.gov&#39; is not in document_data[&#39;links&#39;][&#39;self&#39;]&quot;</span>
        <span class="c1"># document_data[&quot;agencyType&quot;]</span>
        <span class="k">assert</span> <span class="n">check_CFR_data</span><span class="p">(</span><span class="n">document_data</span><span class="p">),</span> <span class="s2">&quot;CFR is not alpha characters&quot;</span>
        <span class="c1"># document_data[&quot;RIN&quot;]</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">],</span> <span class="nb">str</span><span class="p">),</span> <span class="s2">&quot;title is not string&quot;</span>
        <span class="k">assert</span> <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;summary&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;summary&quot;</span><span class="p">],</span> <span class="nb">str</span>
        <span class="p">),</span> <span class="s2">&quot;summary is not string&quot;</span>
        <span class="c1"># document_data[&quot;dates&quot;]</span>
        <span class="c1"># document_data[&quot;furtherInformation&quot;]</span>
        <span class="k">assert</span> <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;supplementaryInformation&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;supplementaryInformation&quot;</span><span class="p">],</span> <span class="nb">str</span>
        <span class="p">),</span> <span class="s2">&quot;supplementaryInformation is not string&quot;</span>

    <span class="k">except</span> <span class="ne">AssertionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">document_data</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;AssertionError: document </span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s2"> -- </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">add_data_quality_flag</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="s2">&quot;document&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.query_register_API_and_merge_document_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">query_register_API_and_merge_document_data</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.query_register_API_and_merge_document_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Attempts to pull document text via federal register API and merge with reg
gov API data</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>doc</code></td>
            <td>
                  <code>json</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the raw json for a document from regulations.gov API</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>merged_doc</code></td>            <td>
                  <code>json</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the json with fields for text from federal register
API</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">query_register_API_and_merge_document_data</span><span class="p">(</span><span class="n">doc</span><span class="p">:</span> <span class="n">json</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">json</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Attempts to pull document text via federal register API and merge with reg</span>
<span class="sd">    gov API data</span>

<span class="sd">    Args:</span>
<span class="sd">        doc (json): the raw json for a document from regulations.gov API</span>

<span class="sd">    Returns:</span>
<span class="sd">        merged_doc (json): the json with fields for text from federal register</span>
<span class="sd">            API</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># extract the document text using the general register API</span>
    <span class="n">fr_doc_num</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frDocNum&quot;</span><span class="p">)</span>
    <span class="n">document_id</span> <span class="o">=</span> <span class="n">doc</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">fr_doc_num</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">xml_url</span> <span class="o">=</span> <span class="n">fetch_fr_document_details</span><span class="p">(</span><span class="n">fr_doc_num</span><span class="p">)</span>
            <span class="n">xml_content</span> <span class="o">=</span> <span class="n">fetch_xml_content</span><span class="p">(</span><span class="n">xml_url</span><span class="p">)</span>
            <span class="n">parsed_xml_content</span> <span class="o">=</span> <span class="n">parse_xml_content</span><span class="p">(</span><span class="n">xml_content</span><span class="p">)</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">parsed_xml_content</span><span class="p">)</span>  <span class="c1"># merge the json objects</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># if there&#39;s an error, that means we can&#39;t use the xml_url to get</span>
            <span class="c1"># the doc text, so we enter None for those fields</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">rf</span><span class="s2">&quot;&quot;&quot;Error accessing federal register xml data for frDocNum</span>
<span class="s2">                </span><span class="si">{</span><span class="n">fr_doc_num</span><span class="si">}</span><span class="s2">, \ document id </span><span class="si">{</span><span class="n">document_id</span><span class="si">}</span><span class="s2">&quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="n">blank_xml_fields</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;agencyType&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;CFR&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;RIN&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;dates&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;furtherInformation&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                <span class="s2">&quot;supplementaryInformation&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">blank_xml_fields</span><span class="p">)</span>  <span class="c1"># merge the json objects</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">blank_xml_fields</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;agencyType&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;CFR&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;RIN&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;summary&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;dates&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;furtherInformation&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;supplementaryInformation&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">doc</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">blank_xml_fields</span><span class="p">)</span>  <span class="c1"># merge the json objects</span>

    <span class="k">return</span> <span class="n">doc</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.validate_fr_doc_num" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_fr_doc_num</span><span class="p">(</span><span class="n">field_value</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.validate_fr_doc_num" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Check the fr_doc_num field is in the right format</p>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_fr_doc_num</span><span class="p">(</span><span class="n">field_value</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check the fr_doc_num field is in the right format</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># this is a decision: we accept None as a value</span>
    <span class="k">if</span> <span class="n">field_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">field_value</span> <span class="o">==</span> <span class="s2">&quot;Not Found&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">char</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">or</span> <span class="n">char</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span> <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">field_value</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="c1"># else</span>
    <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="civiclens.collect.move_data_from_api_to_database.verify_database_existence" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">verify_database_existence</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">api_field_val</span><span class="p">,</span> <span class="n">db_field</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">)</span></code>

<a href="#civiclens.collect.move_data_from_api_to_database.verify_database_existence" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

      <p>Confirm a row exists in a db table for a given id</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>table</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>one of the tables in the CivicLens db</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>api_field_val</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the value we're looking for in the table</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>db_field</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the field in the table where we're looking for the</p>
              </div>
            </td>
            <td>
                  <code>&#39;id&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>boolean indicating the value was found</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/move_data_from_api_to_database.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">verify_database_existence</span><span class="p">(</span>
    <span class="n">table</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">api_field_val</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">db_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;id&quot;</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Confirm a row exists in a db table for a given id</span>

<span class="sd">    Args:</span>
<span class="sd">        table (str): one of the tables in the CivicLens db</span>
<span class="sd">        api_field_val (str): the value we&#39;re looking for in the table</span>
<span class="sd">        db_field (str): the field in the table where we&#39;re looking for the</span>
<span class="sd">        value</span>

<span class="sd">    Returns:</span>
<span class="sd">        boolean indicating the value was found</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">connection</span><span class="p">,</span> <span class="n">cursor</span> <span class="o">=</span> <span class="n">connect_db_and_get_cursor</span><span class="p">()</span>
    <span class="k">with</span> <span class="n">connection</span><span class="p">:</span>
        <span class="k">with</span> <span class="n">cursor</span><span class="p">:</span>
            <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM </span><span class="si">{</span><span class="n">table</span><span class="si">}</span><span class="s2"> WHERE </span><span class="si">{</span><span class="n">db_field</span><span class="si">}</span><span class="s2"> = %s;&quot;</span>  <span class="c1"># noqa: E231, E702</span>
            <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="p">(</span><span class="n">api_field_val</span><span class="p">,))</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">connection</span><span class="p">:</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">connection</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">response</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="civiclens.collect.bulk_dl" class="doc doc-heading">
            <code>bulk_dl</code>


<a href="#civiclens.collect.bulk_dl" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="civiclens.collect.bulk_dl.BulkDl" class="doc doc-heading">
            <code>BulkDl</code>


<a href="#civiclens.collect.bulk_dl.BulkDl" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">


              <details class="quote">
                <summary>Source code in <code>civiclens/collect/bulk_dl.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BulkDl</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the BulkDl class.</span>

<span class="sd">        Args:</span>
<span class="sd">            api_key (str): API key for authenticating requests to the</span>
<span class="sd">            regulations.gov API.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            api_key (str): Stored API key for requests.</span>
<span class="sd">            base_url (str): Base URL for the API endpoint.</span>
<span class="sd">            headers (dict): Headers to include in API requests, containing API</span>
<span class="sd">                key and content type.</span>
<span class="sd">            agencies (list[str]): List of agency identifiers (aggregated from</span>
<span class="sd">                https://www.regulations.gov/agencies) to be used in API calls.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.regulations.gov/v4&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;X-Api-Key&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
            <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">agencies</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;AID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ATBCB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CFPB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CNCS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;COLC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CPPBSD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CPSC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CSB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DHS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOI&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOJ&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOL&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ED&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EEOC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EIB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EOP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EPA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FFIEC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FMC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FRTIB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FTC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GAPFAC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GSA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HHS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HUD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NARA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NASA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NCUA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NLRB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NRC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NSF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NTSB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ONCD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OPM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PBGC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PCLOB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SBA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SSA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TREAS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;USC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;USDA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;VA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ACF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ACL&quot;</span><span class="p">,</span>
            <span class="s2">&quot;AHRQ&quot;</span><span class="p">,</span>
            <span class="s2">&quot;AID&quot;</span><span class="p">,</span>
            <span class="s2">&quot;AMS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;AOA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;APHIS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ARS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ASC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ATBCB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ATF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ATR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ATSDR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BIA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BIS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BLM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BLS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BOEM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BOP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BOR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BPA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BPD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BSC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;BSEE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CCC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CDC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CDFI&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CEQ&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CFPB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CISA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CMS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CNCS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;COE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;COLC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CPPBSD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CPSC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CSB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CSEO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CSREES&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DARS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DEA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DEPO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DHS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOI&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOJ&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOL&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;DOT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EAB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EAC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EBSA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ECAB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ECSA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ED&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EDA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EEOC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EERE&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EIA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EIB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EOA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EOIR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;EPA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ERS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ESA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ETA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FAA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FAR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FAS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FBI&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FCIC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FCSC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FDA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FEMA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FFIEC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FHWA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FINCEN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FIRSTNET&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FISCAL&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FLETC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FMC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FMCSA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FNS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FPAC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FRA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FRTIB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FSA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FSIS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FSOC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FTA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FTC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FTZB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;FWS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GAPFAC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GIPSA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;GSA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HHS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HHSIG&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HRSA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;HUD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;IACB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ICEB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;IHS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;IPEC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;IRS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ISOO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ITA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;LMSO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MARAD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MBDA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MMS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;MSHA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NAL&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NARA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NASA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NASS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NCS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NCUA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NEO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NHTSA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NIC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NIFA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NIGC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NIH&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NIST&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NLRB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NNSA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NOAA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NPS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NRC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NRCS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NSF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NSPC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NTIA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;NTSB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OCC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OEPNU&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OFAC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OFCCP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OFPP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OFR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OJJDP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OJP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OMB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ONCD&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ONDCP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ONRR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OPM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OPPM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OSHA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OSM&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OSTP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;OTS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PBGC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PCLOB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PHMSA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;PTO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RBS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RHS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RITA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RMA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RTB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RUS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SAMHSA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SBA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SEPA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SLSDC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SSA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;SWPA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TREAS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TSA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TTB&quot;</span><span class="p">,</span>
            <span class="s2">&quot;USA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;USAF&quot;</span><span class="p">,</span>
            <span class="s2">&quot;USBC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;USCBP&quot;</span><span class="p">,</span>
            <span class="s2">&quot;USCG&quot;</span><span class="p">,</span>
            <span class="s2">&quot;USCIS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;USDA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;USDAIG&quot;</span><span class="p">,</span>
            <span class="s2">&quot;USGS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;USMINT&quot;</span><span class="p">,</span>
            <span class="s2">&quot;USN&quot;</span><span class="p">,</span>
            <span class="s2">&quot;USPC&quot;</span><span class="p">,</span>
            <span class="s2">&quot;USTR&quot;</span><span class="p">,</span>
            <span class="s2">&quot;VA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;VETS&quot;</span><span class="p">,</span>
            <span class="s2">&quot;WAPA&quot;</span><span class="p">,</span>
            <span class="s2">&quot;WCPO&quot;</span><span class="p">,</span>
            <span class="s2">&quot;WHD&quot;</span><span class="p">,</span>
        <span class="p">]</span>

    <span class="k">def</span> <span class="nf">fetch_all_pages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">max_items_per_page</span><span class="o">=</span><span class="mi">250</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Iterates through all the pages of API data for a given endpoint</span>
<span class="sd">        until there are no more pages to fetch (occurs at 20 pages, or</span>
<span class="sd">        5000 items).</span>

<span class="sd">        Args:</span>
<span class="sd">            endpoint (str): The API endpoint to fetch data from.</span>
<span class="sd">                            [&#39;dockets&#39;, &#39;documents&#39;, &#39;comments&#39;]</span>
<span class="sd">            params (dict): Dictionary of parameters to send in the API request.</span>
<span class="sd">            max_items_per_page (int): Maximum number of items per page to</span>
<span class="sd">            request. Max (default) = 250.</span>

<span class="sd">        Returns:</span>
<span class="sd">            list: A list of items (dictionaries) fetched from all pages of the</span>
<span class="sd">                API endpoint.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page[number]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
            <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page[size]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_items_per_page</span>

            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
                <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requesting: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to decode JSON response&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="n">items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasNextPage&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="k">break</span>
                <span class="n">page</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>  <span class="c1"># Rate limit exceeded</span>
                <span class="n">retry_after</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;Retry-After&quot;</span><span class="p">,</span> <span class="kc">None</span>
                <span class="p">)</span>  <span class="c1"># Obtain reset time</span>
                <span class="n">wait_time</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">retry_after</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">retry_after</span> <span class="ow">and</span> <span class="n">retry_after</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
                    <span class="k">else</span> <span class="mi">3600</span>
                <span class="p">)</span>  <span class="c1"># Default to 1 hour if no wait time provided</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Rate limit exceeded.</span>
<span class="s2">                    Waiting to </span><span class="si">{</span><span class="n">wait_time</span><span class="si">}</span><span class="s2"> seconds to retry.&quot;&quot;&quot;</span>
                <span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching page </span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span>
        <span class="k">return</span> <span class="n">items</span>

    <span class="k">def</span> <span class="nf">get_all_dockets_by_agency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieves all docket IDs by looping through predefined agencies and</span>
<span class="sd">        stores them in a CSV file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_dockets</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">agency</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agencies</span><span class="p">:</span>
            <span class="n">filter_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;filter[agencyId]&quot;</span><span class="p">:</span> <span class="n">agency</span><span class="p">}</span>

            <span class="n">agency_dockets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_all_pages</span><span class="p">(</span><span class="s2">&quot;dockets&quot;</span><span class="p">,</span> <span class="n">filter_params</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">docket</span> <span class="ow">in</span> <span class="n">agency_dockets</span><span class="p">:</span>
                <span class="c1"># Extract relevant information from each docket</span>
                <span class="n">docket_details</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s2">&quot;docket_id&quot;</span><span class="p">:</span> <span class="n">docket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;docket_type&quot;</span><span class="p">:</span> <span class="n">docket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s2">&quot;docketType&quot;</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;last_modified&quot;</span><span class="p">:</span> <span class="n">docket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                        <span class="s2">&quot;lastModifiedDate&quot;</span>
                    <span class="p">),</span>
                    <span class="s2">&quot;agency_id&quot;</span><span class="p">:</span> <span class="n">docket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;agencyId&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">docket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">),</span>
                    <span class="s2">&quot;obj_id&quot;</span><span class="p">:</span> <span class="n">docket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;objectId&quot;</span><span class="p">),</span>
                <span class="p">}</span>
                <span class="n">all_dockets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">docket_details</span><span class="p">)</span>

        <span class="c1"># Store as pandas dataframe.</span>
        <span class="c1"># We can change this mode of storage if you have a different idea,</span>
        <span class="c1"># I think this is a sensible approach, to limit use of our API calls.</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_dockets</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span>
            <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;docket_id&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>  <span class="c1"># Ensure there are no duplicate dockets based on docket_id</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;dockets_detailed.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fetch_documents_by_date_ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches documents posted within specified date ranges and saves them</span>
<span class="sd">        to a CSV file.</span>

<span class="sd">        Args:</span>
<span class="sd">            start_date (datetime.date): Start date for fetching documents.</span>
<span class="sd">            end_date (datetime.date): End date for fetching documents.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">all_documents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_date_ranges</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fetching documents from </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;filter[postedDate][ge]&quot;</span><span class="p">:</span> <span class="n">start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
                <span class="s2">&quot;filter[postedDate][le]&quot;</span><span class="p">:</span> <span class="n">end</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_all_pages</span><span class="p">(</span><span class="s2">&quot;documents&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
            <span class="n">all_documents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total documents fetched: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_documents</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Extract relevant data from documents</span>
        <span class="n">document_lst</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">all_documents</span><span class="p">:</span>
            <span class="n">doc_data</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;Doc_ID&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span>
                <span class="s2">&quot;Doc_Type&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;documentType&quot;</span><span class="p">),</span>
                <span class="s2">&quot;Last_Modified&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;lastModifiedDate&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;FR_Doc_Num&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frDocNum&quot;</span><span class="p">),</span>
                <span class="s2">&quot;Withdrawn&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;withdrawn&quot;</span><span class="p">),</span>
                <span class="s2">&quot;Agency_ID&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;agencyId&quot;</span><span class="p">),</span>
                <span class="s2">&quot;Comment_End_Date&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;commentEndDate&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;Title&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">),</span>
                <span class="s2">&quot;Posted_Date&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;postedDate&quot;</span><span class="p">),</span>
                <span class="s2">&quot;Docket_ID&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;docketId&quot;</span><span class="p">),</span>
                <span class="s2">&quot;Subtype&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subtype&quot;</span><span class="p">),</span>
                <span class="s2">&quot;Comment_Start_Date&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;commentStartDate&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;Open_For_Comment&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;openForComment&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;Object_ID&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;objectId&quot;</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="n">document_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc_data</span><span class="p">)</span>

        <span class="c1"># Save to DataFrame and CSV</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">document_lst</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;doc_detailed_2024.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>  <span class="c1"># for now, we can put this in utils if that is preferred.</span>
    <span class="k">def</span> <span class="nf">generate_date_ranges</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates weekly date ranges between two dates, inclusive.</span>
<span class="sd">        Helped function for fetch_documents_by_date_ranges().</span>

<span class="sd">        Args:</span>
<span class="sd">            start_date (datetime.date): The start date of the range.</span>
<span class="sd">            end_date (datetime.date): The end date of the range.</span>

<span class="sd">        Yields:</span>
<span class="sd">            tuple: A tuple of (start_date, end_date) for each week within the</span>
<span class="sd">                specified range.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">current_date</span> <span class="o">=</span> <span class="n">start_date</span>
        <span class="k">while</span> <span class="n">current_date</span> <span class="o">&lt;</span> <span class="n">end_date</span><span class="p">:</span>
            <span class="n">week_end</span> <span class="o">=</span> <span class="n">current_date</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
            <span class="k">yield</span> <span class="p">(</span><span class="n">current_date</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">week_end</span><span class="p">,</span> <span class="n">end_date</span><span class="p">))</span>
            <span class="n">current_date</span> <span class="o">=</span> <span class="n">week_end</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">fetch_comment_count_by_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document_ids</span><span class="p">,</span> <span class="n">file_output_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetches comments count for each document ID that is open for comments.</span>

<span class="sd">        Args:</span>
<span class="sd">            document_ids (DataFrame): DataFrame containing document IDs under</span>
<span class="sd">            the column &#39;Object_ID&#39;.</span>
<span class="sd">            This can be obtained from the output of</span>
<span class="sd">            fetch_documents_by_date_ranges()</span>
<span class="sd">            file_output_path (str): Path to save the output csv file.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None: Results are saved directly to a csv file specified by</span>
<span class="sd">                file_output_path.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/comments&quot;</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">commentId</span> <span class="ow">in</span> <span class="n">document_ids</span><span class="p">[</span><span class="s2">&quot;Object_ID&quot;</span><span class="p">]:</span>
            <span class="n">continue_fetching</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">while</span> <span class="n">continue_fetching</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;filter[commentOnId]&quot;</span><span class="p">:</span> <span class="n">commentId</span><span class="p">}</span>

                <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="n">base_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                    <span class="n">total_elements</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">][</span><span class="s2">&quot;totalElements&quot;</span><span class="p">]</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">commentId</span><span class="p">,</span> <span class="s2">&quot;total_elements&quot;</span><span class="p">:</span> <span class="n">total_elements</span><span class="p">}</span>
                    <span class="p">)</span>
                    <span class="n">continue_fetching</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>  <span class="c1"># Rate limit exceeded</span>
                    <span class="n">retry_after</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Retry-After&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="n">wait_time</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="nb">int</span><span class="p">(</span><span class="n">retry_after</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">retry_after</span> <span class="ow">and</span> <span class="n">retry_after</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
                        <span class="k">else</span> <span class="mi">3600</span>
                    <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Rate limit exceeded.</span>
<span class="s2">                        Waiting </span><span class="si">{</span><span class="n">wait_time</span><span class="si">}</span><span class="s2"> seconds to retry.&quot;&quot;&quot;</span>
                    <span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">commentId</span><span class="p">,</span> <span class="s2">&quot;total_elements&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed to fetch&quot;</span><span class="p">}</span>
                    <span class="p">)</span>
                    <span class="n">continue_fetching</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="n">results_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_output_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="civiclens.collect.bulk_dl.BulkDl.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span></code>

<a href="#civiclens.collect.bulk_dl.BulkDl.__init__" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Initializes the BulkDl class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>api_key</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>API key for authenticating requests to the</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="civiclens.collect.bulk_dl.BulkDl.__init__.api_key">api_key</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stored API key for requests.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="civiclens.collect.bulk_dl.BulkDl.__init__.base_url">base_url</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Base URL for the API endpoint.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="civiclens.collect.bulk_dl.BulkDl.__init__.headers">headers</span></code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Headers to include in API requests, containing API
key and content type.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="civiclens.collect.bulk_dl.BulkDl.__init__.agencies">agencies</span></code></td>
            <td>
                  <code>list[str]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of agency identifiers (aggregated from
https://www.regulations.gov/agencies) to be used in API calls.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/bulk_dl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initializes the BulkDl class.</span>

<span class="sd">    Args:</span>
<span class="sd">        api_key (str): API key for authenticating requests to the</span>
<span class="sd">        regulations.gov API.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        api_key (str): Stored API key for requests.</span>
<span class="sd">        base_url (str): Base URL for the API endpoint.</span>
<span class="sd">        headers (dict): Headers to include in API requests, containing API</span>
<span class="sd">            key and content type.</span>
<span class="sd">        agencies (list[str]): List of agency identifiers (aggregated from</span>
<span class="sd">            https://www.regulations.gov/agencies) to be used in API calls.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.regulations.gov/v4&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;X-Api-Key&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span>
        <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">agencies</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;AID&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ATBCB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CFPB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CNCS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;COLC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CPPBSD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CPSC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CSB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DHS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DOC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DOD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DOE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DOI&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DOJ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DOL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DOS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DOT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ED&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EEOC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EIB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EOP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EPA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FFIEC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FMC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FRTIB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FTC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GAPFAC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GSA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;HHS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;HUD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NARA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NASA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NCUA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NLRB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NRC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NSF&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NTSB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ONCD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OPM&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PBGC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PCLOB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SBA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SSA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TREAS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;USC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;USDA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;VA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ACF&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ACL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;AHRQ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;AID&quot;</span><span class="p">,</span>
        <span class="s2">&quot;AMS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;AOA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;APHIS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ARS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ASC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ATBCB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ATF&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ATR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ATSDR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BIA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BIS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BLM&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BLS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BOEM&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BOP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BOR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BPA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BPD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BSC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BSEE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CCC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CDC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CDFI&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CEQ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CFPB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CISA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CMS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CNCS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;COE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;COLC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CPPBSD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CPSC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CSB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CSEO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;CSREES&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DARS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DEA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DEPO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DHS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DOC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DOD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DOE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DOI&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DOJ&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DOL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DOS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;DOT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EAB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EAC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EBSA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ECAB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ECSA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ED&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EDA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EEOC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EERE&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EIA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EIB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EOA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EOIR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;EPA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ERS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ESA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ETA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FAA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FAR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FAS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FBI&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FCIC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FCSC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FDA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FEMA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FFIEC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FHWA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FINCEN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FIRSTNET&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FISCAL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FLETC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FMC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FMCSA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FNS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FPAC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FRA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FRTIB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FSA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FSIS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FSOC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FTA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FTC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FTZB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;FWS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GAPFAC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GIPSA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GSA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;HHS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;HHSIG&quot;</span><span class="p">,</span>
        <span class="s2">&quot;HRSA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;HUD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;IACB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ICEB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;IHS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;IPEC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;IRS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ISOO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ITA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;LMSO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MARAD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MBDA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MMS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;MSHA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NAL&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NARA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NASA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NASS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NCS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NCUA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NEO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NHTSA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NIC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NIFA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NIGC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NIH&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NIST&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NLRB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NNSA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NOAA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NPS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NRC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NRCS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NSF&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NSPC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NTIA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;NTSB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OCC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OEPNU&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OFAC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OFCCP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OFPP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OFR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OJJDP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OJP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OMB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ONCD&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ONDCP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ONRR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OPM&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OPPM&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OSHA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OSM&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OSTP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OTS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PBGC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PCLOB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PHMSA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;PTO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RBS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RHS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RITA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RMA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RTB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;RUS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SAMHSA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SBA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SEPA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SLSDC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SSA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;SWPA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TREAS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TSA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;TTB&quot;</span><span class="p">,</span>
        <span class="s2">&quot;USA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;USAF&quot;</span><span class="p">,</span>
        <span class="s2">&quot;USBC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;USCBP&quot;</span><span class="p">,</span>
        <span class="s2">&quot;USCG&quot;</span><span class="p">,</span>
        <span class="s2">&quot;USCIS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;USDA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;USDAIG&quot;</span><span class="p">,</span>
        <span class="s2">&quot;USGS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;USMINT&quot;</span><span class="p">,</span>
        <span class="s2">&quot;USN&quot;</span><span class="p">,</span>
        <span class="s2">&quot;USPC&quot;</span><span class="p">,</span>
        <span class="s2">&quot;USTR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;VA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;VETS&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WAPA&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WCPO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WHD&quot;</span><span class="p">,</span>
    <span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="civiclens.collect.bulk_dl.BulkDl.fetch_all_pages" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fetch_all_pages</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">max_items_per_page</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span></code>

<a href="#civiclens.collect.bulk_dl.BulkDl.fetch_all_pages" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Iterates through all the pages of API data for a given endpoint
until there are no more pages to fetch (occurs at 20 pages, or
5000 items).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>endpoint</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The API endpoint to fetch data from.
            ['dockets', 'documents', 'comments']</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>params</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary of parameters to send in the API request.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_items_per_page</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum number of items per page to</p>
              </div>
            </td>
            <td>
                  <code>250</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of items (dictionaries) fetched from all pages of the
API endpoint.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/bulk_dl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fetch_all_pages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">max_items_per_page</span><span class="o">=</span><span class="mi">250</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Iterates through all the pages of API data for a given endpoint</span>
<span class="sd">    until there are no more pages to fetch (occurs at 20 pages, or</span>
<span class="sd">    5000 items).</span>

<span class="sd">    Args:</span>
<span class="sd">        endpoint (str): The API endpoint to fetch data from.</span>
<span class="sd">                        [&#39;dockets&#39;, &#39;documents&#39;, &#39;comments&#39;]</span>
<span class="sd">        params (dict): Dictionary of parameters to send in the API request.</span>
<span class="sd">        max_items_per_page (int): Maximum number of items per page to</span>
<span class="sd">        request. Max (default) = 250.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list: A list of items (dictionaries) fetched from all pages of the</span>
<span class="sd">            API endpoint.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">page</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page[number]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">page</span>
        <span class="n">params</span><span class="p">[</span><span class="s2">&quot;page[size]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">max_items_per_page</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">endpoint</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Requesting: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Failed to decode JSON response&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="n">items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;hasNextPage&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                <span class="k">break</span>
            <span class="n">page</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>  <span class="c1"># Rate limit exceeded</span>
            <span class="n">retry_after</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;Retry-After&quot;</span><span class="p">,</span> <span class="kc">None</span>
            <span class="p">)</span>  <span class="c1"># Obtain reset time</span>
            <span class="n">wait_time</span> <span class="o">=</span> <span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">retry_after</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">retry_after</span> <span class="ow">and</span> <span class="n">retry_after</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
                <span class="k">else</span> <span class="mi">3600</span>
            <span class="p">)</span>  <span class="c1"># Default to 1 hour if no wait time provided</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Rate limit exceeded.</span>
<span class="s2">                Waiting to </span><span class="si">{</span><span class="n">wait_time</span><span class="si">}</span><span class="s2"> seconds to retry.&quot;&quot;&quot;</span>
            <span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching page </span><span class="si">{</span><span class="n">page</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">break</span>
    <span class="k">return</span> <span class="n">items</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="civiclens.collect.bulk_dl.BulkDl.fetch_comment_count_by_documents" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fetch_comment_count_by_documents</span><span class="p">(</span><span class="n">document_ids</span><span class="p">,</span> <span class="n">file_output_path</span><span class="p">)</span></code>

<a href="#civiclens.collect.bulk_dl.BulkDl.fetch_comment_count_by_documents" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Fetches comments count for each document ID that is open for comments.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>document_ids</code></td>
            <td>
                  <code>DataFrame</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing document IDs under</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>file_output_path</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to save the output csv file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>None</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Results are saved directly to a csv file specified by
file_output_path.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/bulk_dl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fetch_comment_count_by_documents</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">document_ids</span><span class="p">,</span> <span class="n">file_output_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetches comments count for each document ID that is open for comments.</span>

<span class="sd">    Args:</span>
<span class="sd">        document_ids (DataFrame): DataFrame containing document IDs under</span>
<span class="sd">        the column &#39;Object_ID&#39;.</span>
<span class="sd">        This can be obtained from the output of</span>
<span class="sd">        fetch_documents_by_date_ranges()</span>
<span class="sd">        file_output_path (str): Path to save the output csv file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None: Results are saved directly to a csv file specified by</span>
<span class="sd">            file_output_path.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_url</span><span class="si">}</span><span class="s2">/comments&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">commentId</span> <span class="ow">in</span> <span class="n">document_ids</span><span class="p">[</span><span class="s2">&quot;Object_ID&quot;</span><span class="p">]:</span>
        <span class="n">continue_fetching</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">while</span> <span class="n">continue_fetching</span><span class="p">:</span>
            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;filter[commentOnId]&quot;</span><span class="p">:</span> <span class="n">commentId</span><span class="p">}</span>

            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="n">base_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
                <span class="n">total_elements</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;meta&quot;</span><span class="p">][</span><span class="s2">&quot;totalElements&quot;</span><span class="p">]</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">commentId</span><span class="p">,</span> <span class="s2">&quot;total_elements&quot;</span><span class="p">:</span> <span class="n">total_elements</span><span class="p">}</span>
                <span class="p">)</span>
                <span class="n">continue_fetching</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">429</span><span class="p">:</span>  <span class="c1"># Rate limit exceeded</span>
                <span class="n">retry_after</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Retry-After&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="n">wait_time</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">retry_after</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">retry_after</span> <span class="ow">and</span> <span class="n">retry_after</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span>
                    <span class="k">else</span> <span class="mi">3600</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;&quot;&quot;Rate limit exceeded.</span>
<span class="s2">                    Waiting </span><span class="si">{</span><span class="n">wait_time</span><span class="si">}</span><span class="s2"> seconds to retry.&quot;&quot;&quot;</span>
                <span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">wait_time</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="p">{</span><span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="n">commentId</span><span class="p">,</span> <span class="s2">&quot;total_elements&quot;</span><span class="p">:</span> <span class="s2">&quot;Failed to fetch&quot;</span><span class="p">}</span>
                <span class="p">)</span>
                <span class="n">continue_fetching</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="n">results_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
    <span class="n">results_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">file_output_path</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="civiclens.collect.bulk_dl.BulkDl.fetch_documents_by_date_ranges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fetch_documents_by_date_ranges</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span></code>

<a href="#civiclens.collect.bulk_dl.BulkDl.fetch_documents_by_date_ranges" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Fetches documents posted within specified date ranges and saves them
to a CSV file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>start_date</code></td>
            <td>
                  <code><span title="datetime.date">date</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Start date for fetching documents.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>end_date</code></td>
            <td>
                  <code><span title="datetime.date">date</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>End date for fetching documents.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/bulk_dl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fetch_documents_by_date_ranges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fetches documents posted within specified date ranges and saves them</span>
<span class="sd">    to a CSV file.</span>

<span class="sd">    Args:</span>
<span class="sd">        start_date (datetime.date): Start date for fetching documents.</span>
<span class="sd">        end_date (datetime.date): End date for fetching documents.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_documents</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_date_ranges</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fetching documents from </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;filter[postedDate][ge]&quot;</span><span class="p">:</span> <span class="n">start</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
            <span class="s2">&quot;filter[postedDate][le]&quot;</span><span class="p">:</span> <span class="n">end</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">documents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_all_pages</span><span class="p">(</span><span class="s2">&quot;documents&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span>
        <span class="n">all_documents</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">documents</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total documents fetched: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_documents</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Extract relevant data from documents</span>
    <span class="n">document_lst</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">document</span> <span class="ow">in</span> <span class="n">all_documents</span><span class="p">:</span>
        <span class="n">doc_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Doc_ID&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span>
            <span class="s2">&quot;Doc_Type&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;documentType&quot;</span><span class="p">),</span>
            <span class="s2">&quot;Last_Modified&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;lastModifiedDate&quot;</span>
            <span class="p">),</span>
            <span class="s2">&quot;FR_Doc_Num&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frDocNum&quot;</span><span class="p">),</span>
            <span class="s2">&quot;Withdrawn&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;withdrawn&quot;</span><span class="p">),</span>
            <span class="s2">&quot;Agency_ID&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;agencyId&quot;</span><span class="p">),</span>
            <span class="s2">&quot;Comment_End_Date&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;commentEndDate&quot;</span>
            <span class="p">),</span>
            <span class="s2">&quot;Title&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">),</span>
            <span class="s2">&quot;Posted_Date&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;postedDate&quot;</span><span class="p">),</span>
            <span class="s2">&quot;Docket_ID&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;docketId&quot;</span><span class="p">),</span>
            <span class="s2">&quot;Subtype&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;subtype&quot;</span><span class="p">),</span>
            <span class="s2">&quot;Comment_Start_Date&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;commentStartDate&quot;</span>
            <span class="p">),</span>
            <span class="s2">&quot;Open_For_Comment&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="s2">&quot;openForComment&quot;</span>
            <span class="p">),</span>
            <span class="s2">&quot;Object_ID&quot;</span><span class="p">:</span> <span class="n">document</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;objectId&quot;</span><span class="p">),</span>
        <span class="p">}</span>
        <span class="n">document_lst</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">doc_data</span><span class="p">)</span>

    <span class="c1"># Save to DataFrame and CSV</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">document_lst</span><span class="p">)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;doc_detailed_2024.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="civiclens.collect.bulk_dl.BulkDl.generate_date_ranges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_date_ranges</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#civiclens.collect.bulk_dl.BulkDl.generate_date_ranges" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Generates weekly date ranges between two dates, inclusive.
Helped function for fetch_documents_by_date_ranges().</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>start_date</code></td>
            <td>
                  <code><span title="datetime.date">date</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The start date of the range.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>end_date</code></td>
            <td>
                  <code><span title="datetime.date">date</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The end date of the range.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple of (start_date, end_date) for each week within the
specified range.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/bulk_dl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>  <span class="c1"># for now, we can put this in utils if that is preferred.</span>
<span class="k">def</span> <span class="nf">generate_date_ranges</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates weekly date ranges between two dates, inclusive.</span>
<span class="sd">    Helped function for fetch_documents_by_date_ranges().</span>

<span class="sd">    Args:</span>
<span class="sd">        start_date (datetime.date): The start date of the range.</span>
<span class="sd">        end_date (datetime.date): The end date of the range.</span>

<span class="sd">    Yields:</span>
<span class="sd">        tuple: A tuple of (start_date, end_date) for each week within the</span>
<span class="sd">            specified range.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_date</span> <span class="o">=</span> <span class="n">start_date</span>
    <span class="k">while</span> <span class="n">current_date</span> <span class="o">&lt;</span> <span class="n">end_date</span><span class="p">:</span>
        <span class="n">week_end</span> <span class="o">=</span> <span class="n">current_date</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="k">yield</span> <span class="p">(</span><span class="n">current_date</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">week_end</span><span class="p">,</span> <span class="n">end_date</span><span class="p">))</span>
        <span class="n">current_date</span> <span class="o">=</span> <span class="n">week_end</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="civiclens.collect.bulk_dl.BulkDl.get_all_dockets_by_agency" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_all_dockets_by_agency</span><span class="p">()</span></code>

<a href="#civiclens.collect.bulk_dl.BulkDl.get_all_dockets_by_agency" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

      <p>Retrieves all docket IDs by looping through predefined agencies and
stores them in a CSV file.</p>

            <details class="quote">
              <summary>Source code in <code>civiclens/collect/bulk_dl.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_all_dockets_by_agency</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves all docket IDs by looping through predefined agencies and</span>
<span class="sd">    stores them in a CSV file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_dockets</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">agency</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">agencies</span><span class="p">:</span>
        <span class="n">filter_params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;filter[agencyId]&quot;</span><span class="p">:</span> <span class="n">agency</span><span class="p">}</span>

        <span class="n">agency_dockets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fetch_all_pages</span><span class="p">(</span><span class="s2">&quot;dockets&quot;</span><span class="p">,</span> <span class="n">filter_params</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">docket</span> <span class="ow">in</span> <span class="n">agency_dockets</span><span class="p">:</span>
            <span class="c1"># Extract relevant information from each docket</span>
            <span class="n">docket_details</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;docket_id&quot;</span><span class="p">:</span> <span class="n">docket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">),</span>
                <span class="s2">&quot;docket_type&quot;</span><span class="p">:</span> <span class="n">docket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;docketType&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;last_modified&quot;</span><span class="p">:</span> <span class="n">docket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                    <span class="s2">&quot;lastModifiedDate&quot;</span>
                <span class="p">),</span>
                <span class="s2">&quot;agency_id&quot;</span><span class="p">:</span> <span class="n">docket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;agencyId&quot;</span><span class="p">),</span>
                <span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="n">docket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">),</span>
                <span class="s2">&quot;obj_id&quot;</span><span class="p">:</span> <span class="n">docket</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;objectId&quot;</span><span class="p">),</span>
            <span class="p">}</span>
            <span class="n">all_dockets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">docket_details</span><span class="p">)</span>

    <span class="c1"># Store as pandas dataframe.</span>
    <span class="c1"># We can change this mode of storage if you have a different idea,</span>
    <span class="c1"># I think this is a sensible approach, to limit use of our API calls.</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_dockets</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span>
        <span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;docket_id&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>  <span class="c1"># Ensure there are no duplicate dockets based on docket_id</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;dockets_detailed.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  </body>
</html>