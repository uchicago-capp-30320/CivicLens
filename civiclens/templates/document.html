{% extends "layouts/base.html" %}

{% block title %}
    {{doc.title}}
{% endblock title %}


{% block content %}

<!-- whole page -->
<section class="slice py-3" style="background-color:#FDFFF7" id="core-block">
  <!-- title section -->
  <div class="container p-4 py-0" style="background-color: rgba(180, 47, 55, 0.15); border: 15px solid #FDFFF7;">
    {% if comments_nlp.doc_plain_english_title %}
      <h5>{{ comments_nlp.doc_plain_english_title }}</h5>
      <h6 class="font-italic font-weight-normal">Original title: {{ doc.title }}</h6>
    {% else %}
      <h5>{{ doc.title }}</h5>
    {% endif %}
  </div>

  <!-- two sectioned part of the page -->
  <div class="container">
    <div class="input-group mb-3 order-md-1">
      <div class="col-md-3 p-2" >
        <!-- commenting details section -->
        <span class="h6 font-weight-bold" >Commenting Details</span>
        <p></p>

        <div class="card-sm" style="background-color: lightgrey;">
          <div class="card-body py-2 px-3">
            <p class="card-text">
              <a class="font-weight-bold">Comment by</a>
              <a class="font-weight-normal">{{ doc.comment_end_date }}</a>
            </p>
          </div>
        </div>

        <div class="card-sm" style="background-color: lightgrey;">
          <div class="card-body py-2 px-3">
            <p class="card-text">
              <a class="font-weight-bold">Posted on</a>
              <a class="font-weight-normal">{{ doc.posted_date }}</a>
            </p>
          </div>
        </div>

        <div class="card-sm" style="background-color: lightgrey;">
          <div class="card-body py-2 px-3">
            <p class="card-text">
              <a class="font-weight-bold">Agency</a>
              <a class="font-weight-normal">{{ doc.agency_id }}</a>
            </p>
          </div>
        </div>

        <div class="card-sm" style="background-color: lightgrey;">
          <div class="card-body py-2 px-3">
            <p class="card-text">
              <a class="font-weight-bold">Comments received</a>
              <a class="font-weight-normal">{{ doc.comment_count }}</a>
            </p>
          </div>
        </div>

        <div class="card-sm" style="background-color: lightgrey;">
          <div class="card-body py-2 px-3">
            <p class="card-text">
              <a class="font-weight-bold">Unique comments received</a>
              <a class="font-weight-normal">{{ unique_comments }}</a>
            </p>
          </div>
        </div>

        <p class="text-right small">
          <a class="font-italic">comments last updated:</a> {{ comments_last_updated }}
        </p>

        <!-- in the weeds section -->
        <span class="h6 font-weight-bold">In the Weeds</span>

        <p></p>
        <div class="card-sm" style="background-color: lightgrey;">
          <div class="card-body py-2 px-3">
            <p class="card-text">
              <a class="font-weight-bold">Document ID</a>
              <a class="font-weight-normal">{{ doc.id }}</a>
            </p>
          </div>
        </div>

        <div class="card-sm" style="background-color: lightgrey;">
          <div class="card-body py-2 px-3">
            <p class="card-text">
              <a class="font-weight-bold">Federal Register ID</a>
              <a class="font-weight-normal">{{ doc.fr_doc_num }}</a>
            </p>
          </div>
        </div>

        <div class="card-sm" style="background-color: lightgrey;">
          <div class="card-body py-2 px-3">
            <p class="card-text">
              <a class="font-weight-bold">Docket ID</a>
              <a class="font-weight-normal">{{ doc.docket_id }}</a>
            </p>
          </div>
        </div>

        <p></p>
        <p class="small"> Want to get even more in the weeds? </p>
        <a href="https://www.regulations.gov/document/{{doc.id}}" target="_blank"
          class="btn btn-sm font-weight-normal text-white"
          style="background-color:#B42F37; color:#FDFFF7;">
          Explore supplementary materials on regulations.gov
        </a>
      </div>

      <!-- container for the document summary, NLP results -->
      <div class="col-md-8">
        {% comment %} <span class="h6">Summary</span> {% endcomment %}
        <p></p>
          <div class="card p-3">
            <div class="card-body">
              {% if doc.summary %}
                <p class="card-text">{{ doc.summary }}</p>
              {% else %}
                <p class="card-text">There is no summary for this document.</p>
              {% endif %}
            </div>
          </div>
        {% if comments_nlp.rep_comments %}
          <span class="h6">{{ comments_nlp.num_topics }} topics emerged from {{ doc.comment_count }} total comments.</span>
          <p></p>
          <span class="p">[methods here...]</span>
          <span class="p">[methods here...]</span>
          <span class="p">[methods here...]</span>
          <div class="container-fluid p-1 h-25" style="background-color: #FDFFF7;" id="chart">
            <!-- hacky way to get comments.topics into the script -->
            <!-- this is where we might be able to do alt text -->
            <div id="topics" style="display: none;">
              {{comments_nlp.topics}}
            </div>
            {% load static %}
            <p></p>
            <script type="text/javascript" src="{% static '/js/graph.js' %}"></script>
          </div>
          <p class="text-right small">
            <a class="font-italic">topics last updated:</a> {{ comments_nlp.last_updated }}
          </p>

          <hr>
          <p></p>
          <span class="h6">{{ comments_nlp.num_rep_comments }} representative comments representing {{ comments_nlp.num_total_comments }} total comments.</span>
          <p>The following comments capture the core themes of the comments received.
            [potentially include some clarity on the methods used here].
          </p>
          {% for rep_comment in comments_nlp.rep_comments %}
          <!-- cards for each representative comment -->
            <div class="card p-0">
              <div class="card-body">
                <p class="card-text p-2">{{ rep_comment.text }}</p>
              </div>
              <div class="card-footer p-2 d-flex justify-content-between align-items-end">
                <div>
                  {% if rep_comment.topic %}
                    <p class="card-text body font-weight-bold text-dark mb-0">Topic: {{ rep_comment.topic }}</p>
                  {% endif %}
                  {% if rep_comment.num_represented %}
                    <p class="card-text body text-dark">{{ rep_comment.num_represented }} comments like this</p>
                  {% endif %}
                </div>
                <div class="text-right">
                  {% if rep_comment.form_letter %}
                    <p class="text-right mb-0">Form letter</p>
                  {% else %}
                    <p class="text-right mb-0">Unique comment</p>
                  {% endif %}
                </div>
              </div>
            </div>
          {% endfor %}

        {% elif comments_api %}
          <hr>
          <p></p>
          <span class="h6">{{ doc.comment_count }} Total Comments</span>
          <p></p>
          {% for comment in comments_api %}
          <!-- cards for each representative comment -->
            <div class="card p-0">
              <div class="card-body">
                <p class="card-text p-2">{{ comment.comment }}</p>
              </div>
              <div class="card-footer p-2">
                {% comment %} {% if comment.organization %}
                  <p class="text-muted text-right mb-0">comment.commenter_name</p>
                {% elif comment.last_name %}
                  <p class="text-muted text-right mb-0">{{comment.first_name}} {{comment.last_name}}</p>
                {% endif %} {% endcomment %}
                <p class="text-muted text-right">commented on {{ comment.posted_date_only }}.</p>

              </div>
            </div>
          {% endfor %}
        {% endif %}

        {% if comments_nlp or comments_api  %}
          <div style="text-align: center;">
            <a href="https://www.regulations.gov/commenton/{{doc.id}}" target="_blank"
              class="btn btn-sm font-weight-normal text-white"
              style="background-color:#21315C; color:#FDFFF7;">
              Add your own comment!
            </a>

            <a href="https://www.regulations.gov/commenton/{{doc.id}}/comment" target="_blank"
              class="btn btn-sm btn-outline-primary font-weight-normal"
              style="background-color:white; color:#21315C;">
              Browse all existing comments
            </a>
          </div>

        {% else %}
          <div style="text-align: center;">
            <button class="btn btn-sm" style="background-color:#21315C; color:#FDFFF7;">
              <a href="https://www.regulations.gov/commenton/{{doc.id}}" target="_blank" class="font-weight-normal text-white">
                Be the first to comment!
              </a>
            </button>
          </div>

        {% endif %}
      </div>
    </div>
  </div>
</section>

{% endblock content %}
