{% extends "layouts/base.html" %}

{% block title %}
    Documents
{% endblock title %}

<head>
  <link rel="stylesheet" type="text/css" href="/static/css/base.css">
</head>

{% block content %}
<div class="form-group">
  <form action="/search/results/" method="GET">
    <input type="hidden" name="source" value="search_results">
    {% csrf_token %}
    {{ form.as_p }}

    <!-- search bar section -->
    <section class="slice py-4" style="background-color:#FDFFF7; padding:0" id="core-block">
      <div class="container-sm py-0">
        <div class="input-group mb-4">
          <input class="form-control" id="q" name="q" type="text" value="{{ context.form.q.value }}">
          <button class="btn btn-primary">Search</button>
        </div>
      </div>
    </section>

    <!-- sort/filter section -->
    <section class="slice py-0" style="background-color:#FDFFF7" id="core-block">
      <div class="container">
        <div class="input-group mb-3 order-md-1">
          <div class="col-md-3" >
            <!-- sort section -->
            <span class="h6 font-weight-bold" >Sort by:</span>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="sort_by" id="most_relevant" value="most_relevant" {% if context.form.sort_by.value == "most_relevant" %}checked{% endif %}>
              <label class="form-check-label" for="most_relevant">Most relevant</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="sort_by" id="most_recent" value="most_recent" {% if context.form.sort_by.value == "most_recent" %}checked{% endif %}>
              <label class="form-check-label" for="most_recent">Most recent</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="sort_by" id="most_comments" value="most_comments" {% if context.form.sort_by.value == "most_comments" %}checked{% endif %}>
              <label class="form-check-label" for="most_comments">Most comments</label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="sort_by" id="least_comments" value="least_comments" {% if context.form.sort_by.value == "least_comments" %}checked{% endif %}>
              <label class="form-check-label" for="least_comments">Least comments</label>
            </div>

            <!-- filter section -->
            <p></p>
            <p></p>
            <span class="h6 font-weight-bold">Filter by:</span>
            <h6 class="font-italic font-weight-normal">Number of comments</h6>
            <div class="custom-switch">
              <input class="custom-control-input" type="checkbox" id="flexSwitchCheckDefault" name="comments_any" value="True" {% if context.form.comments_any.value %}checked{% endif %}>
              <label class="custom-control-label" for="flexSwitchCheckDefault">Contains any comments</label>
            </div>
            <div class="custom-switch">
              <input class="custom-control-input" type="checkbox" id="flexSwitchCheckDefault2" name="comments_over_hundred" value="True" {% if context.form.comments_over_hundred.value %}checked{% endif %}>
              <label class="custom-control-label" for="flexSwitchCheckDefault2">Contains 100+ comments</label>
            </div>
            <p></p>

            <div class="form-group agency-container">
              <label class="font-italic">Agency</label>
              <select multiple class="form-control agency-list" id="selected_agencies" name="selected_agencies">
                <!-- for loop through all agencies in the database -- USE JINJA -->
                {% for agency in agencies %}
                <option value="{{ agency.id }}" {% if agency.id|stringformat:"s" in context.form.selected_agencies.value %}selected{% endif %}>
                  {{ agency.id }}: {{ agency.name }}
                </option>
                  {% comment %} <option>{{ agency.id }}</option> {% endcomment %}
                {% endfor %}
              </select>
              <button type="button" class="btn btn-secondary mt-2" style="padding: 2px 6px; font-size: 12px;" onclick="uncheckAgencies()">Deselect All Agencies</button>
            </div>
            <script>
              function uncheckAgencies() {
                var agencySelect = document.getElementById('selected_agencies');
                for (var i = 0; i < agencySelect.options.length; i++) {
                  agencySelect.options[i].selected = false;
                }
              }
            </script>

            <!-- filter by types of documents, default to all -->
            <div class="form-group" >
              <label for="exampleFormControlSelect2" class="font-italic">Category</label>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="rule" id="rule" value="Rule" {% if not context.form.source.value %}checked{%elif context.form.rule.value %}checked{% endif %}>
                <label class="form-check-label" for="rule">
                  Rule
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="proposed_rule" id="Proposed Rule" value="Proposed Rule" {% if not context.form.source.value %}checked{% elif context.form.proposed_rule.value %}checked{% endif %}>
                <label class="form-check-label" for="proposed_rule">
                  Proposed Rule
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="notice" id="notice" value="Notice" {% if not context.form.source.value %}checked{% elif context.form.notice.value %}checked{% endif %}>
                <label class="form-check-label" for="notice">
                  Notice
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="other" id="other" value="Other" {% if not context.form.source.value %}checked{% elif context.form.other.value %}checked{% endif %}>
                <label class="form-check-label" for="other">
                  Other
                </label>
              </div>
            <p></p>
            <button class="btn btn-sm" style="background-color:#B42F37; color:#FDFFF7">Refine results</button>
            </div>
          </div>

            <!-- container for the actual Documents -->

          <div class="col-md-8 order-md-2">
            <span class="h6 font-weight-normal font-italic">Displaying {{ context.documents.count }} results for "{{ context.search }}".</span>
            <p></p>
            {% if context.documents %}
            {% for doc in context.documents %}
              <div class="card p-3">
                <div class="card-body">
                {% if doc.ai_title %}
                  <p class="text-left font-weight-bolder mb-0">
                    <a href="{% url 'document' doc.id %}"> {{ doc.ai_title }}</a>
                  </p>
                  <p class="font-italic bodytext-muted">Original Title: {{ doc.title }}</p>
                {% else %}
                  <p class="text-left font-weight-bolder mb-0">
                    <a href="{% url 'document' doc.id %}"> {{ doc.title }}</a>
                  </p>
                {% endif %}
                {% if doc.summary %}
                  <p class="card-text">{{ doc.summary|truncatewords:30 }}</p>
                {% endif %}
                  <button href="#" class="badge mb-2">doc.topic</button>
                </div>
                <div class="card-footer text-muted p-0 text-right" >
                  comment by {{ doc.comment_end_date }}
                </div>
              </div>
              {% endfor %}
            {% else %}
              Your search did not match any documents at this time.  Try adjusting your search query, or browse through agencies to find something similar.
            {% endif %}
          </div>
        </div>
      </div>
    </section>
  </form>
</div>

{% endblock content %}
